<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Plots and models of variant effect sizes</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<link rel="icon" href="https://github.com/workflowr/workflowr-assets/raw/master/img/reproducible.png">
<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">fitnessGWAS</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="license.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/lukeholman/fitnessGWAS">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Plots and models of variant effect sizes</h1>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span> workflowr <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> </a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2021-10-01
</p>
<p>
<strong>Checks:</strong> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 7 <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span> 0
</p>
<p>
<strong>Knit directory:</strong> <code>fitnessGWAS/</code> <span class="glyphicon glyphicon-question-sign" aria-hidden="true" title="This is the local directory in which the code in this file was executed."> </span>
</p>
<p>
This reproducible <a href="http://rmarkdown.rstudio.com">R Markdown</a> analysis was created with <a
  href="https://github.com/jdblischak/workflowr">workflowr</a> (version 1.6.2). The <em>Checks</em> tab describes the reproducibility checks that were applied when the results were created. The <em>Past versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguptodate"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>R Markdown file:</strong> up-to-date </a>
</p>
</div>
<div id="strongRMarkdownfilestronguptodate" class="panel-collapse collapse">
<div class="panel-body">
<p>Great! Since the R Markdown file has been committed to the Git repository, you know the exact version of the code that produced these results.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the global environment can affect the analysis in your R Markdown file in unknown ways. For reproduciblity it’s best to always run the code in an empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20180914code"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Seed:</strong> <code>set.seed(20180914)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20180914code" class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20180914)</code> was run prior to running the code in the R Markdown file. Setting a seed ensures that any results that rely on randomness, e.g. subsampling or permutations, are reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Session information:</strong> recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be confident that you successfully produced the results during this run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomlukeholmanfitnessGWAStree01226ab272891d92a8444e19cac034c1b079d263targetblank01226aba"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Repository version:</strong> <a href="https://github.com/lukeholman/fitnessGWAS/tree/01226ab272891d92a8444e19cac034c1b079d263" target="_blank">01226ab</a> </a>
</p>
</div>
<div id="strongRepositoryversionstrongahrefhttpsgithubcomlukeholmanfitnessGWAStree01226ab272891d92a8444e19cac034c1b079d263targetblank01226aba" class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development and connecting the code version to the results is critical for reproducibility.
</p>
<p>
The results in this page were generated with repository version <a href="https://github.com/lukeholman/fitnessGWAS/tree/01226ab272891d92a8444e19cac034c1b079d263" target="_blank">01226ab</a>. See the <em>Past versions</em> tab to see a history of the changes made to the R Markdown and HTML files.
</p>
<p>
Note that you need to be careful to ensure that all relevant files for the analysis have been committed to Git prior to generating the results (you can use <code>wflow_publish</code> or <code>wflow_git_commit</code>). workflowr only checks the R Markdown file, but you know if there are other scripts or data files that it depends on. Below is the status of the Git repository when the results were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    .DS_Store
    Ignored:    .Rapp.history
    Ignored:    .Rhistory
    Ignored:    .Rproj.user/
    Ignored:    .httr-oauth
    Ignored:    .pversion
    Ignored:    analysis/.DS_Store
    Ignored:    analysis/correlations_SNP_effects_cache/
    Ignored:    code/.DS_Store
    Ignored:    code/Drosophila_GWAS.Rmd
    Ignored:    data/.DS_Store
    Ignored:    data/derived/
    Ignored:    data/input/.DS_Store
    Ignored:    data/input/.pversion
    Ignored:    data/input/dgrp.fb557.annot.txt
    Ignored:    data/input/dgrp2.bed
    Ignored:    data/input/dgrp2.bim
    Ignored:    data/input/dgrp2.fam
    Ignored:    data/input/huang_transcriptome/
    Ignored:    figures/.DS_Store
    Ignored:    figures/fig1_inkscape.svg
    Ignored:    figures/figure1a.pdf
    Ignored:    figures/figure1b.pdf

Untracked files:
    Untracked:  big_model.rds
    Untracked:  code/quant_gen_1.R
    Untracked:  data/input/genomic_relatedness_matrix.rds
    Untracked:  old_analyses/

Unstaged changes:
    Modified:   .gitignore
    Modified:   figures/GWAS_stats_figure.pdf
    Modified:   figures/SNP_effect_ED.pdf
    Modified:   figures/TWAS_stats_figure.pdf
    Modified:   figures/antagonism_ratios.pdf
    Modified:   figures/boyle_plot.pdf
    Modified:   figures/composite_mixture_figure.pdf
    Modified:   figures/eff_size_histos.pdf

</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not included in this status report because it is ok for generated content to have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">

<p>
These are the previous versions of the repository in which changes were made to the R Markdown (<code>analysis/plot_models_variant_effects.Rmd</code>) and HTML (<code>docs/plot_models_variant_effects.html</code>) files. If you’ve configured a remote Git repository (see <code>?wflow_git_remote</code>), click on the hyperlinks in the table below to view the files as they were in that past version.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/lukeholman/fitnessGWAS/4953d582430e0be9ac5f56212ce2e1ee0478d936/docs/plot_models_variant_effects.html" target="_blank">4953d58</a>
</td>
<td>
lukeholman
</td>
<td>
2021-09-26
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/2bf87505a56e12debcab79eb42fd1313bc1b2f31/analysis/plot_models_variant_effects.Rmd" target="_blank">2bf8750</a>
</td>
<td>
lukeholman
</td>
<td>
2021-09-26
</td>
<td>
Commit Sept 2021
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/lukeholman/fitnessGWAS/8d14298b4d59c2198b6f9c62d415e6adc9b7e658/docs/plot_models_variant_effects.html" target="_blank">8d14298</a>
</td>
<td>
lukeholman
</td>
<td>
2021-09-26
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/af15dd63a476b2499f2be7f3002df3ec72c28522/analysis/plot_models_variant_effects.Rmd" target="_blank">af15dd6</a>
</td>
<td>
lukeholman
</td>
<td>
2021-09-26
</td>
<td>
Commit Sept 2021
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/lukeholman/fitnessGWAS/871ae81fa56175675b53d22ca29bf9323c3ed50a/docs/plot_models_variant_effects.html" target="_blank">871ae81</a>
</td>
<td>
lukeholman
</td>
<td>
2021-03-04
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/lukeholman/fitnessGWAS/e112260eb7edb940edc701a4180d2cf98f9d1145/docs/plot_models_variant_effects.html" target="_blank">e112260</a>
</td>
<td>
lukeholman
</td>
<td>
2021-03-04
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/c606d3d8748d48cc6dd479febb9ce71effc8bcfd/analysis/plot_models_variant_effects.Rmd" target="_blank">c606d3d</a>
</td>
<td>
lukeholman
</td>
<td>
2021-03-04
</td>
<td>
big first commit 2021
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<pre class="r"><code>library(tidyverse)
library(gridExtra)
library(qqman)
library(ggbeeswarm)
library(Hmisc)
library(showtext) # For fancy Google font in figures
library(mashr)
library(kableExtra)
library(cowplot)
library(grid)
font_add_google(name = &quot;Raleway&quot;, family = &quot;Raleway&quot;, regular.wt = 400, bold.wt = 700) # Install font from Google Fonts
showtext_auto()

db &lt;- DBI::dbConnect(RSQLite::SQLite(), 
                     &quot;data/derived/annotations.sqlite3&quot;)

# Results for all 1,613,615 SNPs, even those that are in 100% LD with others (these are grouped up by the SNP_clump column)
all_snps &lt;- tbl(db, &quot;univariate_lmm_results&quot;)

# All SNPs and SNP groups that are in &lt;100% LD with one another (n = 1,207,357)
SNP_clumps &lt;- all_snps %&gt;% select(-SNP) %&gt;% distinct() %&gt;% collect(n = Inf)

# Subsetting variable to get the approx-LD subset of SNPs
LD_subset &lt;- !is.na(SNP_clumps$LFSR_female_early_mashr_ED)</code></pre>
<div id="load-and-clean-the-variant-effect-sizes" class="section level2">
<h2>Load and clean the variant effect sizes</h2>
<p>Modify column names, reorder columns, filter based on the p-value, etc.</p>
<pre class="r"><code># Univariate analysis, mashr-adjusted, data-driven approach
univariate_lmm_results &lt;- tbl(db, &quot;univariate_lmm_results&quot;) %&gt;% 
  select(-contains(&quot;canonical&quot;), 
         -contains(&quot;raw&quot;)) %&gt;% 
  inner_join(tbl(db, &quot;variants&quot;) %&gt;% 
               select(SNP, FBID, site.class, distance.to.gene, MAF), 
             by = &quot;SNP&quot;) %&gt;%
  left_join(
    tbl(db, &quot;genes&quot;) %&gt;% 
      select(FBID, gene_name), by = &quot;FBID&quot;) %&gt;%
  collect(n = Inf) %&gt;%
  rename_all(~ gsub(&quot;beta_&quot;, &quot;&quot;, .x)) %&gt;%
  rename_all(~ gsub(&quot;_mashr_ED&quot;, &quot;&quot;, .x))

univariate_lmm_results &lt;- univariate_lmm_results %&gt;%
  mutate(site.class = gsub(&quot;5_&quot;, &quot;5-&quot;, site.class),
         site.class = gsub(&quot;3_&quot;, &quot;3-&quot;, site.class),
         site.class = gsub(&quot;NON_&quot;, &quot;NON-&quot;, site.class),
         site.class = gsub(&quot;_&quot;, &quot; &quot;, site.class),
         site.class = capitalize(tolower(site.class)),
         site.class = gsub(&quot;Utr&quot;, &quot;UTR&quot;, site.class)
  )

# Results of one multivariate linear mixed model run in GEMMA:
# multivariate_lmm_results &lt;- 
#   read_tsv(&quot;data/derived/output/all_four_traits.assoc.txt&quot;) %&gt;%
#   filter(p_fdr &lt; 0.05) %&gt;% 
#   inner_join(tbl(db, &quot;variants&quot;) %&gt;% 
#                select(-chr, -position) %&gt;%
#                collect(), by = &quot;SNP&quot;) %&gt;% 
#   arrange(p_wald) %&gt;% 
#   select(-contains(&quot;Vbeta&quot;)) %&gt;%
#   left_join(
#     tbl(db, &quot;genes&quot;) %&gt;% 
#       select(FBID, gene_name) %&gt;% 
#       collect(n=Inf), by = &quot;FBID&quot;) %&gt;%
#   mutate(gene_name = replace(gene_name, is.na(FBID), NA)) 
# 
# multivariate_lmm_results &lt;- multivariate_lmm_results[,c(1:8, 14, 9:13)]
# 
# multivariate_lmm_results &lt;- multivariate_lmm_results %&gt;%
#   mutate_at(vars(starts_with(&quot;p_&quot;)), ~ -log10(.x)) %&gt;%
#   mutate_if(is.numeric, ~ format(round(.x, 2), nsmall = 2)) %&gt;%
#   left_join(tbl(db, &quot;univariate_lmm_results&quot;) %&gt;% 
#               select(SNP, SNP_clump) %&gt;% 
#               collect(),
#             by = &quot;SNP&quot;) %&gt;%
#   distinct(SNP_clump, .keep_all = TRUE) %&gt;%
#   select(SNP, SNP_clump, everything())</code></pre>
</div>
<div id="q-q-plots" class="section level2 tabset">
<h2>Q-Q plots</h2>
<p>Here are some quantile-quantile plots, which are commonly used to check GWAS results, and to test the hypothesis that there are more SNPs than expected showing large effects on the trait of interest. There is an excess of loci with effects on female fitness, but not much of a visible excess for males.</p>
<div id="female-early-life-fitness" class="section level3">
<h3>Female early-life fitness</h3>
<pre class="r"><code># univariate_lmm_pvals &lt;- tbl(db, &quot;univariate_lmm_results&quot;) %&gt;%
#   select(contains(&quot;LFSR&quot;)) %&gt;% select(contains(&quot;ED&quot;)) %&gt;% collect(n=Inf) %&gt;% as.data.frame()
# qqman::qq(univariate_lmm_results$LFSR_female_early_mashr_ED)

univariate_lmm_pvals &lt;- SNP_clumps %&gt;%
  select(contains(&quot;pvalue&quot;)) %&gt;% filter(LD_subset) %&gt;% as.data.frame()
qqman::qq(univariate_lmm_pvals$pvalue_female_early_raw)</code></pre>
<p><img src="figure/plot_models_variant_effects.Rmd/qqplot1-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-qqplot1-1">
Past versions of qqplot1-1.png
</button>
</p>
<div id="fig-qqplot1-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/8d14298b4d59c2198b6f9c62d415e6adc9b7e658/docs/figure/plot_models_variant_effects.Rmd/qqplot1-1.png" target="_blank">8d14298</a>
</td>
<td>
lukeholman
</td>
<td>
2021-09-26
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="female-late-life-fitness" class="section level3">
<h3>Female late-life fitness</h3>
<pre class="r"><code>#qqman::qq(univariate_lmm_results$LFSR_female_late_mashr_ED)
qqman::qq(univariate_lmm_pvals$pvalue_female_late_raw)</code></pre>
<p><img src="figure/plot_models_variant_effects.Rmd/qqplot2-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-qqplot2-1">
Past versions of qqplot2-1.png
</button>
</p>
<div id="fig-qqplot2-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/8d14298b4d59c2198b6f9c62d415e6adc9b7e658/docs/figure/plot_models_variant_effects.Rmd/qqplot2-1.png" target="_blank">8d14298</a>
</td>
<td>
lukeholman
</td>
<td>
2021-09-26
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="male-early-life-fitness" class="section level3">
<h3>Male early-life fitness</h3>
<pre class="r"><code># qqman::qq(univariate_lmm_results$LFSR_male_early_mashr_ED)
qqman::qq(univariate_lmm_pvals$pvalue_male_early_raw)</code></pre>
<p><img src="figure/plot_models_variant_effects.Rmd/qqplot3-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-qqplot3-1">
Past versions of qqplot3-1.png
</button>
</p>
<div id="fig-qqplot3-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/8d14298b4d59c2198b6f9c62d415e6adc9b7e658/docs/figure/plot_models_variant_effects.Rmd/qqplot3-1.png" target="_blank">8d14298</a>
</td>
<td>
lukeholman
</td>
<td>
2021-09-26
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="male-late-life-fitness" class="section level3">
<h3>Male late-life fitness</h3>
<pre class="r"><code># qqman::qq(univariate_lmm_results$LFSR_male_late_mashr_ED)
qqman::qq(univariate_lmm_pvals$pvalue_male_late_raw)</code></pre>
<p><img src="figure/plot_models_variant_effects.Rmd/qqplot4-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-qqplot4-1">
Past versions of qqplot4-1.png
</button>
</p>
<div id="fig-qqplot4-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/8d14298b4d59c2198b6f9c62d415e6adc9b7e658/docs/figure/plot_models_variant_effects.Rmd/qqplot4-1.png" target="_blank">8d14298</a>
</td>
<td>
lukeholman
</td>
<td>
2021-09-26
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="hex-bin-plots-and-correlations-in-variant-effect-sizes" class="section level2">
<h2>Hex bin plots and correlations in variant effect sizes</h2>
<div id="effect-sizes-adjusted-using-data-driven-adaptive-shrinkage" class="section level3 tabset">
<h3>Effect sizes adjusted using ‘data-driven’ adaptive shrinkage</h3>
<div id="plot" class="section level4">
<h4>Plot</h4>
<pre class="r"><code>hex_plot &lt;- function(x, y, xlab, ylab, title,
                     xlim = c(-0.5, 0.5),
                     ylim = c(-0.3, 0.3)
                     ){
  dat &lt;- SNP_clumps %&gt;%
    mutate(facet = title) %&gt;% 
    filter(LD_subset) # ensure only the LD SNPs from mashr are plotted
  ggplot(dat, aes_string(x, y)) + 
    geom_abline(linetype = 2) + 
    geom_vline(xintercept = 0, linetype = 3) +
    geom_hline(yintercept = 0, linetype = 3) +
    stat_binhex(bins = 50)  +
    geom_density_2d(colour = &quot;white&quot;, alpha = 0.6) + 
    scale_fill_viridis_c() + 
    coord_cartesian(xlim = xlim, ylim = ylim) + 
    facet_wrap(~ facet) +
    theme_bw() + xlab(xlab) + ylab(ylab) +
    theme(legend.position = &quot;none&quot;,
          strip.background = element_blank(),
          strip.text = element_text(hjust=0))   + 
    theme(text = element_text(family = &quot;Raleway&quot;, size = 12))

}

p1 &lt;- hex_plot(&quot;beta_female_early_mashr_ED&quot;, 
               &quot;beta_male_early_mashr_ED&quot;, 
               &quot;Effect on female fitness&quot;, 
               NULL,
               &quot;A. Early life fitness&quot;)

p2 &lt;- hex_plot(&quot;beta_female_late_mashr_ED&quot;, 
               &quot;beta_male_late_mashr_ED&quot;, 
               &quot;Effect on female fitness&quot;, 
               NULL,
               &quot;B. Late life fitness&quot;)

grid.arrange(p1, p2, ncol = 2, left = &quot;Effect on male fitness&quot;)</code></pre>
<p><img src="figure/plot_models_variant_effects.Rmd/hex1-1.png" width="864" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-hex1-1">
Past versions of hex1-1.png
</button>
</p>
<div id="fig-hex1-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/8d14298b4d59c2198b6f9c62d415e6adc9b7e658/docs/figure/plot_models_variant_effects.Rmd/hex1-1.png" target="_blank">8d14298</a>
</td>
<td>
lukeholman
</td>
<td>
2021-09-26
</td>
</tr>
<tr>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/e112260eb7edb940edc701a4180d2cf98f9d1145/docs/figure/plot_models_variant_effects.Rmd/hex1-1.png" target="_blank">e112260</a>
</td>
<td>
lukeholman
</td>
<td>
2021-03-04
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Figure 2</strong>: Effect sizes of 1207357 loci (i.e. groups of one or more polymorphic sites in complete linkage disequilibrium) on male and female fitness, plotted separately for the early-life and late-life estimates. The effect sizes estimated using GEMMA have been corrected using mashr, using the data-driven method to apply shrinkage (Figure SX shows the raw estimates). The data have been binned into hexagons, with the colour and contour lines indicating the number of loci. The diagonal line represents <span class="math inline">\(y=x\)</span>. Positive effect sizes indicate that the minor allele is associated with higher fitness.</p>
</div>
<div id="pearson-correlation" class="section level4">
<h4>Pearson correlation</h4>
<pre class="r"><code>SNP_clumps %&gt;%
  select(contains(&quot;mashr_ED&quot;)) %&gt;%
  select(contains(&quot;beta&quot;)) %&gt;%
  rename_all(~ paste(ifelse(str_detect(.x, &quot;female&quot;), &quot;Female&quot;, &quot;Male&quot;), 
                     ifelse(str_detect(.x, &quot;early&quot;), &quot;early&quot;, &quot;late&quot;))) %&gt;%
  cor(use = &quot;pairwise.complete.obs&quot;) %&gt;% 
  kable(digits = 3) %&gt;% kable_styling(full_width = FALSE)</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Female early
</th>
<th style="text-align:right;">
Female late
</th>
<th style="text-align:right;">
Male early
</th>
<th style="text-align:right;">
Male late
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Female early
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.998
</td>
<td style="text-align:right;">
0.911
</td>
<td style="text-align:right;">
0.950
</td>
</tr>
<tr>
<td style="text-align:left;">
Female late
</td>
<td style="text-align:right;">
0.998
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.880
</td>
<td style="text-align:right;">
0.927
</td>
</tr>
<tr>
<td style="text-align:left;">
Male early
</td>
<td style="text-align:right;">
0.911
</td>
<td style="text-align:right;">
0.880
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.994
</td>
</tr>
<tr>
<td style="text-align:left;">
Male late
</td>
<td style="text-align:right;">
0.950
</td>
<td style="text-align:right;">
0.927
</td>
<td style="text-align:right;">
0.994
</td>
<td style="text-align:right;">
1.000
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="effect-sizes-adjusted-using-canonical-adaptive-shrinkage" class="section level3 tabset">
<h3>Effect sizes adjusted using ‘canonical’ adaptive shrinkage</h3>
<div id="plot-1" class="section level4">
<h4>Plot</h4>
<p>The unusual distribution here reflects the fact that this analysis imposed constraints on the effects of each locus. For example, loci assigned to the ‘Female-specific’ category with high probability necessarily have an effect size close to zero in males. The figure should be interpreted cautiously - the main purpose of the canonical analysis is to inference the mixture proportions, and to assign mixture probabilities to each locus, not to accurately estimate the true effect size of each variant.</p>
<pre class="r"><code>p1 &lt;- hex_plot(&quot;beta_female_early_mashr_canonical&quot;, 
           &quot;beta_male_early_mashr_canonical&quot;, 
           &quot;Effect on female fitness&quot;, 
           NULL,
           &quot;A. Early life fitness&quot;)

p2 &lt;- hex_plot(&quot;beta_female_late_mashr_canonical&quot;, 
           &quot;beta_male_late_mashr_canonical&quot;, 
           &quot;Effect on female fitness&quot;, 
           NULL,
           &quot;B. Late life fitness&quot;)

grid.arrange(p1, p2, ncol = 2, left = &quot;Effect on male fitness&quot;)</code></pre>
<p><img src="figure/plot_models_variant_effects.Rmd/hex2-1.png" width="864" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-hex2-1">
Past versions of hex2-1.png
</button>
</p>
<div id="fig-hex2-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/8d14298b4d59c2198b6f9c62d415e6adc9b7e658/docs/figure/plot_models_variant_effects.Rmd/hex2-1.png" target="_blank">8d14298</a>
</td>
<td>
lukeholman
</td>
<td>
2021-09-26
</td>
</tr>
<tr>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/e112260eb7edb940edc701a4180d2cf98f9d1145/docs/figure/plot_models_variant_effects.Rmd/hex2-1.png" target="_blank">e112260</a>
</td>
<td>
lukeholman
</td>
<td>
2021-03-04
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="pearson-correlation-1" class="section level4">
<h4>Pearson correlation</h4>
<pre class="r"><code>SNP_clumps %&gt;%
  select(contains(&quot;mashr_canonical&quot;)) %&gt;%
  select(contains(&quot;beta&quot;)) %&gt;%
  rename_all(~ paste(ifelse(str_detect(.x, &quot;female&quot;), &quot;Female&quot;, &quot;Male&quot;), 
                     ifelse(str_detect(.x, &quot;early&quot;), &quot;early&quot;, &quot;late&quot;))) %&gt;%
  cor(use = &quot;pairwise.complete.obs&quot;) %&gt;% 
  kable(digits = 3) %&gt;% kable_styling(full_width = FALSE)</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Female early
</th>
<th style="text-align:right;">
Female late
</th>
<th style="text-align:right;">
Male early
</th>
<th style="text-align:right;">
Male late
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Female early
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.855
</td>
<td style="text-align:right;">
0.855
</td>
</tr>
<tr>
<td style="text-align:left;">
Female late
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.855
</td>
<td style="text-align:right;">
0.855
</td>
</tr>
<tr>
<td style="text-align:left;">
Male early
</td>
<td style="text-align:right;">
0.855
</td>
<td style="text-align:right;">
0.855
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
1.000
</td>
</tr>
<tr>
<td style="text-align:left;">
Male late
</td>
<td style="text-align:right;">
0.855
</td>
<td style="text-align:right;">
0.855
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
1.000
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="unadjusted-effect-sizes" class="section level3 tabset">
<h3>Unadjusted effect sizes</h3>
<div id="plot-2" class="section level4">
<h4>Plot</h4>
<p>Uses the variant effect sizes output by GEMMA, without applying any shrinkage (i.e. this is the data that was adjusted using <code>mashr</code>).</p>
<pre class="r"><code>p1 &lt;- hex_plot(&quot;beta_female_early_raw&quot;, 
           &quot;beta_male_early_raw&quot;, 
           &quot;Effect on female fitness&quot;, 
           NULL,
           &quot;A. Early life fitness&quot;,
           xlim = c(-1, 1),
           ylim = c(-1, 1))

p2 &lt;- hex_plot(&quot;beta_female_late_raw&quot;, 
           &quot;beta_male_late_raw&quot;, 
           &quot;Effect on female fitness&quot;, 
           NULL,
           &quot;B. Late life fitness&quot;,
           xlim = c(-1, 1),
           ylim = c(-1, 1))

grid.arrange(p1, p2, ncol = 2, left = &quot;Effect on male fitness&quot;)</code></pre>
<p><img src="figure/plot_models_variant_effects.Rmd/hex3-1.png" width="864" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-hex3-1">
Past versions of hex3-1.png
</button>
</p>
<div id="fig-hex3-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/8d14298b4d59c2198b6f9c62d415e6adc9b7e658/docs/figure/plot_models_variant_effects.Rmd/hex3-1.png" target="_blank">8d14298</a>
</td>
<td>
lukeholman
</td>
<td>
2021-09-26
</td>
</tr>
<tr>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/e112260eb7edb940edc701a4180d2cf98f9d1145/docs/figure/plot_models_variant_effects.Rmd/hex3-1.png" target="_blank">e112260</a>
</td>
<td>
lukeholman
</td>
<td>
2021-03-04
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="pearson-correlation-2" class="section level4">
<h4>Pearson correlation</h4>
<pre class="r"><code>SNP_clumps %&gt;%
  select(contains(&quot;raw&quot;)) %&gt;%
  select(contains(&quot;beta&quot;)) %&gt;%
  rename_all(~ paste(ifelse(str_detect(.x, &quot;female&quot;), &quot;Female&quot;, &quot;Male&quot;), 
                     ifelse(str_detect(.x, &quot;early&quot;), &quot;early&quot;, &quot;late&quot;))) %&gt;%
  cor(use = &quot;pairwise.complete.obs&quot;) %&gt;% 
  kable(digits = 3) %&gt;% kable_styling(full_width = FALSE)</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Female early
</th>
<th style="text-align:right;">
Female late
</th>
<th style="text-align:right;">
Male early
</th>
<th style="text-align:right;">
Male late
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Female early
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.567
</td>
<td style="text-align:right;">
0.220
</td>
<td style="text-align:right;">
0.118
</td>
</tr>
<tr>
<td style="text-align:left;">
Female late
</td>
<td style="text-align:right;">
0.567
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.215
</td>
<td style="text-align:right;">
0.167
</td>
</tr>
<tr>
<td style="text-align:left;">
Male early
</td>
<td style="text-align:right;">
0.220
</td>
<td style="text-align:right;">
0.215
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.434
</td>
</tr>
<tr>
<td style="text-align:left;">
Male late
</td>
<td style="text-align:right;">
0.118
</td>
<td style="text-align:right;">
0.167
</td>
<td style="text-align:right;">
0.434
</td>
<td style="text-align:right;">
1.000
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="average-effect-sizes-are-negative" class="section level2 tabset">
<h2>Average effect sizes are negative</h2>
<p>Each of the following four tests is an intercept-only linear model, weighted by the inverse of the standard error for the focal variant’s effect size (so, loci where the effect effect size was measured with more precision are weighted more heavily). The tests are run on the LD-pruned subset of SNPs, minimising pseudoreplication. A non-zero intercept term indicates that major (or minor) alleles tend to have consistently positive or negative associations with the focal fitness trait.</p>
<p>These results indicate that the minor allele tends to <em>reduce</em> fitness, relative to the major allele. It’s a weak effect (note the small value in the Estimate column), this may reflect the large uncertainty with which the effect sizes are measured, in addition to a true biological result that most loci have little or no relationship with the fitness traits we measured.</p>
<div id="female-early-life" class="section level3">
<h3>Female early-life</h3>
<pre class="r"><code>summary(lm(beta_female_early_raw ~ 1, 
           data = SNP_clumps %&gt;% filter(LD_subset), 
           weights = 1 / SE_female_early_raw))</code></pre>
<pre><code>
Call:
lm(formula = beta_female_early_raw ~ 1, data = SNP_clumps %&gt;% 
    filter(LD_subset), weights = 1/SE_female_early_raw)

Weighted Residuals:
     Min       1Q   Median       3Q      Max 
-1.98458 -0.22630  0.00919  0.23696  1.48781 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.0016820  0.0002555  -6.584 4.58e-11 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 0.3497 on 208986 degrees of freedom</code></pre>
</div>
<div id="female-late-life" class="section level3">
<h3>Female late-life</h3>
<pre class="r"><code>summary(lm(beta_female_late_raw ~ 1, 
           data = SNP_clumps %&gt;% filter(LD_subset), 
           weights = 1 / SE_female_late_raw))</code></pre>
<pre><code>
Call:
lm(formula = beta_female_late_raw ~ 1, data = SNP_clumps %&gt;% 
    filter(LD_subset), weights = 1/SE_female_late_raw)

Weighted Residuals:
     Min       1Q   Median       3Q      Max 
-1.94128 -0.23405  0.00409  0.23909  1.47335 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.0025016  0.0002598   -9.63   &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 0.3549 on 208986 degrees of freedom</code></pre>
</div>
<div id="male-early-life" class="section level3">
<h3>Male early-life</h3>
<pre class="r"><code>summary(lm(beta_male_early_raw ~ 1, 
           data = SNP_clumps %&gt;% filter(LD_subset), 
           weights = 1 / SE_male_early_raw))</code></pre>
<pre><code>
Call:
lm(formula = beta_male_early_raw ~ 1, data = SNP_clumps %&gt;% filter(LD_subset), 
    weights = 1/SE_male_early_raw)

Weighted Residuals:
     Min       1Q   Median       3Q      Max 
-1.58868 -0.23295 -0.00219  0.23114  1.76956 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.0016140  0.0002542   -6.35 2.15e-10 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 0.3503 on 208986 degrees of freedom</code></pre>
</div>
<div id="male-late-life" class="section level3">
<h3>Male late-life</h3>
<pre class="r"><code>summary(lm(beta_male_late_raw ~ 1, 
           data = SNP_clumps %&gt;% filter(LD_subset), 
           weights = 1 / SE_male_late_raw))</code></pre>
<pre><code>
Call:
lm(formula = beta_male_late_raw ~ 1, data = SNP_clumps %&gt;% filter(LD_subset), 
    weights = 1/SE_male_late_raw)

Weighted Residuals:
     Min       1Q   Median       3Q      Max 
-1.89125 -0.22874  0.00114  0.23182  1.59205 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.001943   0.000251  -7.739    1e-14 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 0.3479 on 208986 degrees of freedom</code></pre>
</div>
</div>
<div id="test-boyle-idea" class="section level2">
<h2>Test boyle idea</h2>
<p>Inspired by Boyle et al. (Cell), we sorted all of the variants by their fitness effects, placed them in bins of 1000, and then calculated the average fitness effect for each bin. Figure 4 shows that there was a very tight correlation between the average effects of the variants in each bin on male and female fitness. This is what would predict if variants that affect male fitness tend to also affect female fitness in the same direction, and if a very large number of loci have small (and concordant) effects on the fitness of both sexes.</p>
<pre class="r"><code>p1 &lt;- SNP_clumps %&gt;%
  filter(LD_subset) %&gt;% # The figure looks the same whether or not the data are thinned to the LD set of SNPs
  arrange(beta_female_early_raw) %&gt;%
  mutate(bin = c(rep(1:floor(n()/1000), each = 1000), 
                 rep(floor(n()/1000) + 1, each = n() %% 1000)),
         age = &quot;A. Early life&quot;) %&gt;%
  group_by(bin, age) %&gt;%
  summarise(females = mean(beta_female_early_raw), males = mean(beta_male_early_raw)) %&gt;%
  ggplot(aes(females, males)) +
  geom_hline(yintercept = 0, linetype = 2) +
  geom_vline(xintercept = 0, linetype = 2) +
  geom_point() +
  stat_smooth(method = &quot;lm&quot;, formula = y ~ x + I(x^2), size = 0.6) +
  facet_wrap(~ age) +
  scale_y_continuous(limits = c(-0.1, 0.27)) +
  xlab(NULL) + ylab(NULL) + 
  theme_bw() +
  theme(strip.background = element_blank(),
        strip.text = element_text(hjust=0))   + 
  theme(text = element_text(family = &quot;Raleway&quot;, size = 12))

p2 &lt;- SNP_clumps %&gt;%
  filter(LD_subset) %&gt;% 
  arrange(beta_female_late_raw) %&gt;%
  mutate(bin = c(rep(1:floor(n()/1000), each = 1000), 
                 rep(floor(n()/1000) + 1, each = n() %% 1000)),
         age = &quot;B. Late life&quot;) %&gt;%
  group_by(bin, age) %&gt;%
  summarise(females = mean(beta_female_late_raw), males = mean(beta_male_late_raw)) %&gt;%
  ggplot(aes(females, males)) +
  geom_hline(yintercept = 0, linetype = 2) +
  geom_vline(xintercept = 0, linetype = 2) +
  geom_point() +
  stat_smooth(method = &quot;lm&quot;, formula = y ~ x + I(x^2), size = 0.6) +
  facet_wrap(~ age) +
  scale_y_continuous(limits = c(-0.1, 0.27)) +
  xlab(NULL) + ylab(NULL) + 
  theme_bw() +
  theme(strip.background = element_blank(),
        strip.text = element_text(hjust=0))   + 
  theme(text = element_text(family = &quot;Raleway&quot;, size = 12))

grid.arrange(p1, p2, nrow = 1, bottom = &quot;Mean effect size on female fitness&quot;, 
  left = &quot;Mean effect size on male fitness&quot;)</code></pre>
<p><img src="figure/plot_models_variant_effects.Rmd/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-11-1">
Past versions of unnamed-chunk-11-1.png
</button>
</p>
<div id="fig-unnamed-chunk-11-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/8d14298b4d59c2198b6f9c62d415e6adc9b7e658/docs/figure/plot_models_variant_effects.Rmd/unnamed-chunk-11-1.png" target="_blank">8d14298</a>
</td>
<td>
lukeholman
</td>
<td>
2021-09-26
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="plot-the-estimated-mixture-proportions-from-mashr" class="section level2">
<h2>Plot the estimated mixture proportions from <code>mashr</code></h2>
<pre class="r"><code># Make plot for the GWAS
mashr_results_canonical &lt;- read_rds(&quot;data/derived/mashr_results_canonical.rds&quot;)
mashr_2L &lt;- readRDS(&quot;data/derived/mashr_results_canonical_chr2L.rds&quot;)
mashr_2R &lt;- readRDS(&quot;data/derived/mashr_results_canonical_chr2R.rds&quot;)
mashr_3L &lt;- readRDS(&quot;data/derived/mashr_results_canonical_chr3L.rds&quot;)
mashr_3R &lt;- readRDS(&quot;data/derived/mashr_results_canonical_chr3R.rds&quot;)
mashr_X &lt;- readRDS(&quot;data/derived/mashr_results_canonical_chrX.rds&quot;)

mix &lt;- bind_rows(
  enframe(sort(get_estimated_pi(mashr_results_canonical))) %&gt;%
    mutate(Chromosome = &quot;All&quot;),
  enframe(sort(get_estimated_pi(mashr_2L))) %&gt;%
    mutate(Chromosome = &quot;2L&quot;),
  enframe(sort(get_estimated_pi(mashr_2R))) %&gt;%
    mutate(Chromosome = &quot;2R&quot;),
  enframe(sort(get_estimated_pi(mashr_3L))) %&gt;%
    mutate(Chromosome = &quot;3L&quot;),
  enframe(sort(get_estimated_pi(mashr_3R))) %&gt;%
    mutate(Chromosome = &quot;3R&quot;),
  enframe(sort(get_estimated_pi(mashr_X))) %&gt;%
    mutate(Chromosome = &quot;X&quot;)) %&gt;% 
  rename(Mixture_component = name) 

to_keep &lt;- mix %&gt;%
  group_by(Mixture_component) %&gt;%
  summarise(value = max(value), .groups = &quot;drop&quot;) %&gt;%
  filter(value &gt; 0.01) %&gt;%
  pull(Mixture_component)

mix &lt;- mix %&gt;%
  filter(Mixture_component %in% to_keep) %&gt;%
  spread(Mixture_component, value) %&gt;%
  rename(`Sexually concordant effect` = equal_effects,
         `Female-specific effect` = Female_specific_1,
         `Male-specific effect` = Male_specific_1,
         `Sexually antagonistic effect` = Sex_antag_0.25,
         `No effect on fitness` = null) %&gt;%
  gather(Mixture_component, value, -Chromosome) %&gt;%
  arrange(-value) 

chr_levels &lt;- mix %&gt;% 
  filter(Mixture_component == &quot;Sexually antagonistic effect&quot;) %&gt;%
  arrange(value) %&gt;% pull(Chromosome)

mix &lt;- mix %&gt;%
  mutate(Chromosome = factor(Chromosome, chr_levels),
         Mixture_component = factor(Mixture_component, 
                                    c(&quot;Sexually antagonistic effect&quot;,
                                      &quot;Sexually concordant effect&quot;,
                                      &quot;Female-specific effect&quot;,
                                      &quot;Male-specific effect&quot;,
                                      &quot;No effect on fitness&quot;))) 


p1 &lt;- mix %&gt;%
  ggplot(aes(Chromosome, 100 * value)) + 
  geom_bar(stat = &quot;identity&quot;,aes(fill = Chromosome), colour = &quot;grey10&quot;,  size = 0.3) + 
  scale_fill_brewer(palette = &quot;Spectral&quot;, direction = -1) + 
  coord_flip() + 
  theme_bw() + 
  scale_y_continuous(expand = c(0,0), limits = c(0, 70)) + 
  scale_x_discrete(expand = c(0.14, 0.14)) + 
  theme(axis.ticks.y = element_blank(),
        legend.position = &quot;none&quot;,
        panel.border = element_rect(size = 0.8),
        text = element_text(family = &quot;Raleway&quot;, size = 12),
        strip.background = element_blank(),
        panel.grid.major.y = element_blank()) +
  ylab(&quot;Estimated % of loci&quot;) +
  facet_wrap(~ Mixture_component, ncol = 1)


# Make plot for the TWAS
mashr_results_canonical &lt;- readRDS(&quot;data/derived/TWAS/TWAS_canonical.rds&quot;)
mashr_2L &lt;- readRDS(&quot;data/derived/TWAS/TWAS_canonical_2L.rds&quot;)
mashr_2R &lt;- readRDS(&quot;data/derived/TWAS/TWAS_canonical_2R.rds&quot;)
mashr_3L &lt;- readRDS(&quot;data/derived/TWAS/TWAS_canonical_3L.rds&quot;)
mashr_3R &lt;- readRDS(&quot;data/derived/TWAS/TWAS_canonical_3R.rds&quot;)
mashr_X &lt;- readRDS(&quot;data/derived/TWAS/TWAS_canonical_X.rds&quot;)

mix &lt;- bind_rows(
  enframe(sort(get_estimated_pi(mashr_results_canonical))) %&gt;%
    mutate(Chromosome = &quot;All&quot;),
  enframe(sort(get_estimated_pi(mashr_2L))) %&gt;%
    mutate(Chromosome = &quot;2L&quot;),
  enframe(sort(get_estimated_pi(mashr_2R))) %&gt;%
    mutate(Chromosome = &quot;2R&quot;),
  enframe(sort(get_estimated_pi(mashr_3L))) %&gt;%
    mutate(Chromosome = &quot;3L&quot;),
  enframe(sort(get_estimated_pi(mashr_3R))) %&gt;%
    mutate(Chromosome = &quot;3R&quot;),
  enframe(sort(get_estimated_pi(mashr_X))) %&gt;%
    mutate(Chromosome = &quot;X&quot;)) %&gt;% 
  rename(Mixture_component = name) %&gt;%
  mutate(Mixture_component = str_remove_all(Mixture_component, &quot;_0.25&quot;),
         Mixture_component = str_remove_all(Mixture_component, &quot;_0.5&quot;),
         Mixture_component = str_remove_all(Mixture_component, &quot;_0.75&quot;),
         Mixture_component = str_remove_all(Mixture_component, &quot;_1.0&quot;)) %&gt;%
  group_by(Mixture_component, Chromosome) %&gt;%
  summarise(value = sum(value), .groups = &quot;drop&quot;)

to_keep &lt;- mix %&gt;%
  group_by(Mixture_component) %&gt;%
  summarise(value = max(value), .groups = &quot;drop&quot;) %&gt;%
  filter(value &gt; 0.01) %&gt;%
  pull(Mixture_component)

mix &lt;- mix %&gt;%
  filter(Mixture_component %in% to_keep) %&gt;%
  spread(Mixture_component, value) %&gt;%
  rename(`Sexually concordant effect` = equal_effects,
         `Female-specific effect` = Female_specific_1,
         `Male-specific effect` = Male_specific_1,
         `Sexually antagonistic effect` = Sex_antag,
         `No effect on fitness` = null) %&gt;%
  gather(Mixture_component, value, -Chromosome) %&gt;%
  arrange(-value) 

chr_levels &lt;- rev(c(&quot;X&quot;, &quot;3L&quot;, &quot;3R&quot;, &quot;All&quot;, &quot;2R&quot;, &quot;2L&quot;))

mix &lt;- mix %&gt;%
  mutate(Chromosome = factor(Chromosome, chr_levels),
         Mixture_component = factor(Mixture_component, 
                                    c(&quot;Sexually antagonistic effect&quot;,
                                      &quot;Sexually concordant effect&quot;,
                                      &quot;Female-specific effect&quot;,
                                      &quot;Male-specific effect&quot;,
                                      &quot;No effect on fitness&quot;))) 

p2 &lt;- mix %&gt;%
  ggplot(aes(Chromosome, 100 * value)) + 
  geom_bar(stat = &quot;identity&quot;,aes(fill = Chromosome), colour = &quot;grey10&quot;,  size = 0.3) + 
  scale_fill_brewer(palette = &quot;Spectral&quot;, direction = -1) + 
  coord_flip() + 
  theme_bw() + 
  scale_y_continuous(expand = c(0,0), limits = c(0, 65)) + # 
  scale_x_discrete(expand = c(0.14, 0.14)) + 
  theme(axis.ticks.y = element_blank(),
        legend.position = &quot;none&quot;,
        panel.border = element_rect(size = 0.8),
        text = element_text(family = &quot;Raleway&quot;, size = 12),
        strip.background = element_blank(),
        panel.grid.major.y = element_blank()) +
  ylab(&quot;Estimated % of transcripts&quot;) +
  xlab(&quot; &quot;) + 
  facet_wrap(~ Mixture_component, ncol = 1)


# Save composite figure of the GWAS and TWAS mixture proportions
ggsave(filename = &quot;figures/composite_mixture_figure.pdf&quot;, 
       cowplot::plot_grid(p1, p2, labels = c(&#39;A&#39;, &#39;B&#39;), label_size = 12),
       width = 5, height = 8)

cowplot::plot_grid(p1, p2, labels = c(&#39;A&#39;, &#39;B&#39;), label_size = 12)</code></pre>
<p><img src="figure/plot_models_variant_effects.Rmd/mixture_props-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-mixture_props-1">
Past versions of mixture_props-1.png
</button>
</p>
<div id="fig-mixture_props-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/8d14298b4d59c2198b6f9c62d415e6adc9b7e658/docs/figure/plot_models_variant_effects.Rmd/mixture_props-1.png" target="_blank">8d14298</a>
</td>
<td>
lukeholman
</td>
<td>
2021-09-26
</td>
</tr>
<tr>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/e112260eb7edb940edc701a4180d2cf98f9d1145/docs/figure/plot_models_variant_effects.Rmd/mixture_props-1.png" target="_blank">e112260</a>
</td>
<td>
lukeholman
</td>
<td>
2021-03-04
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Figure X</strong>: Proportions of each type of locus, as estimated using the mixture model computed by <code>mashr</code> in the analysis using canonical covariance matrices. This analysis involved a number of pre-specified covariance matrices, each corresponding to a type of locus that we hypothesised to exist (shown in panel headings). The analysis fit some other matrix types not shown here, because the corresponding locus type was inferred to be rare/absent (these included neutral loci, estimated to comprise 0.5-1% of those tested, and age-antagonistic loci, none of which were detected). The analysis was run either using all 1,207,357 loci for which data were available (labeled ‘All’) or for all loci on each of the chromosomes (chromosomes 4 and Y had insufficient data). Notably, sexually-antagonistic loci were inferred to be especially common on the X chromosome, loci that affected males only were inferred to be rarer than those affecting females only, and chromosome 2R had many more female-specific than male-specific loci.</p>
<!-- ## Plot SNP effects by site class {.tabset} -->
<!-- Here, we set a local false sign rate threshold of 0.001, to ensure that more of the SNPs plotted here have genuine positive or negative effect on the focal phenotype. We then plot the estimate of each SNP's effect on the focal phenotype separately for each site class, to test whether certain  -->
<!-- ```{r} -->
<!-- do_boxplots <- function(trait, lfsr){ -->
<!--   names(univariate_lmm_results)[names(univariate_lmm_results) == trait] <- "focal_trait" -->
<!--   names(univariate_lmm_results)[names(univariate_lmm_results) == lfsr] <- "lfsr" -->
<!--   dat <- univariate_lmm_results %>% -->
<!--     mutate(site.class = as.character(site.class)) %>% -->
<!--     filter(lfsr < 0.01) %>% -->
<!--     mutate(sign = ifelse(focal_trait < 0, "Negative", "Positive"))  -->
<!--   # Combine these rare site classes: -->
<!--   dat$site.class[dat$site.class %in%  -->
<!--                    c("Codon change plus codon insertion",  -->
<!--                      "Codon insertion", "Splice site region",  -->
<!--                      "Start gained")] <- "Other site class" -->
<!--   levels <- dat %>% -->
<!--     group_by(site.class) %>% -->
<!--     summarise(m = median(abs(focal_trait[focal_trait < 0])), .groups = "drop") %>% -->
<!--     arrange(m) %>% pull(site.class) -->
<!--   dat <- mutate(dat, site.class = factor(site.class, levels[!is.na(levels)])) %>% -->
<!--         filter(!is.na(site.class))  -->
<!--   grand_median_neg <- dat %>% -->
<!--     filter(sign == "Negative") %>% -->
<!--     summarise(m = median(focal_trait), .groups = "drop") %>% pull(m) -->
<!--   grand_median_pos <- dat %>% -->
<!--     filter(sign == "Positive") %>% -->
<!--     summarise(m = median(focal_trait), .groups = "drop") %>% pull(m) -->
<!--   group_medians <-  -->
<!--     bind_rows( -->
<!--       dat %>% -->
<!--         filter(sign == "Negative") %>% -->
<!--         group_by(site.class) %>% -->
<!--         summarise(focal_trait = median(focal_trait), .groups = "drop") %>% -->
<!--         mutate(sign = "negative"), -->
<!--       dat %>% -->
<!--         filter(sign == "Positive") %>% -->
<!--         group_by(site.class) %>% -->
<!--         summarise(focal_trait = median(focal_trait), .groups = "drop") %>% -->
<!--         mutate(sign = "positive") -->
<!--     ) -->
<!--   dat  %>% -->
<!--     ggplot(aes(x = site.class, y = focal_trait)) +  -->
<!--     geom_hline(yintercept = grand_median_neg, linetype = 2, colour = "tomato", size = 1.4) +  -->
<!--     geom_hline(yintercept = grand_median_pos, linetype = 2, colour = "tomato", size = 1.4) +  -->
<!--     geom_boxplot(aes(fill = site.class, group = paste(sign, site.class)),  position = "identity") +  -->
<!--     scale_x_discrete(expand = c(0.1, 0.1)) + -->
<!--     coord_flip() + -->
<!--     theme_bw() +  -->
<!--     theme(legend.position = "none") + -->
<!--     ylab("Estimated effect size of the minor allele") + -->
<!--     xlab("Site class of the variant") -->
<!-- } -->
<!-- ``` -->
<!-- ### Female early-life fitness -->
<!-- ```{r fig.showtext=TRUE, fig.height = 6, fig.width = 5} -->
<!-- do_boxplots("female_early", "LFSR_female_early") -->
<!-- ``` -->
<!-- ### Female late-life fitness -->
<!-- ```{r fig.showtext=TRUE, fig.height = 6, fig.width = 5} -->
<!-- do_boxplots("female_late", "LFSR_female_late") -->
<!-- ``` -->
<!-- ### Male early-life fitness -->
<!-- ```{r fig.showtext=TRUE, fig.height = 6, fig.width = 5} -->
<!-- do_boxplots("male_early", "LFSR_male_early") -->
<!-- ``` -->
<!-- ### Male late-life fitness -->
<!-- ```{r fig.showtext=TRUE, fig.height = 6, fig.width = 5} -->
<!-- do_boxplots("male_late", "LFSR_male_late") -->
<!-- ``` -->
</div>
<div id="statistical-models-effects-of-site-class-maf-and-chromosome" class="section level2">
<h2>Statistical models: effects of site class, MAF and chromosome</h2>
<p>The following models test whether site class, MAF (minor allele frequency) and chromosome predict how each locus affected our four phenotypes.</p>
<p>These analyses use the mixture assignment probabilities calculated by <code>mashr</code> (in the “canonical” analysis). For every locus, the <code>mashr</code> analysis calculated the probability that each locus was A) sexually antagonistic (meaning it had opposite effects on male and female fitness that were consistent across the two age categories), B) female-specific (meaning it affect female fitness but not male), C) male-specific (affecting male fitness only), and D) had equal effects on all four phenotypes (mean the allele that associated with higher fitness in males also was associated with higher fitness in females). Other types of loci were also considered in the model (e.g. null effect loci and ones with age-specific effects), but these were found to be quite rare, precluding analysis here.</p>
<p>Here, we use these mixture assignment probabilities as the response variable, in order to ask whether e.g. sexually antagonistic loci tend to appear in any particular type of site or chromosome, and whether they had a higher or lower MAF than average. Since these probabilities are bounded between zero and one, we use beta regression (a form of GLM designed to model variables in the range [0,1]). We fit a full model with site class, MAF and chromosome as predictor variables, as well as all the simpler nested models, and compare them using AICc model selection. We also present the results of the full model, and plot the parameter estimates from each of the four models below.</p>
<p>The dataset used in this model is</p>
<div id="tables-of-statistical-results-models-of-gwas-effects" class="section level3">
<h3>Tables of statistical results (models of GWAS effects)</h3>
<pre class="r"><code>library(betareg)
library(MuMIn)
library(&quot;lmtest&quot;)

LFSR_cutoff &lt;- 0.05

dat &lt;- univariate_lmm_results %&gt;%
  filter(LFSR_female_early &lt; LFSR_cutoff | LFSR_female_late &lt; LFSR_cutoff | 
           LFSR_male_early &lt; LFSR_cutoff | LFSR_male_late &lt; LFSR_cutoff) %&gt;%
  mutate(chr = gsub(&quot;_&quot;, &quot;&quot;, substr(SNP, 1, 2))) %&gt;%
  select(SNP, SNP_clump, starts_with(&quot;P_&quot;), MAF, site.class, chr) %&gt;%
  distinct() 

# Focus only on the commonest site classes:
dat &lt;- dat %&gt;% 
  filter(site.class %in% c(&quot;Intron&quot;, &quot;Intergenic&quot;, &quot;Downstream&quot;, &quot;Upstream&quot;,
                           &quot;Synonymous coding&quot;, &quot;Non-synonymous coding&quot;, &quot;UTR 3-prime&quot;,
                           &quot;Exon&quot;, &quot;UTR 5-prime&quot;)) 

# Remove chromosome 4 (too few sites)
dat &lt;- dat %&gt;% filter(chr != &quot;4&quot;) 

# If there are multiple site classes for a SNP, or multiple SNPs 
# in the same 100% LD clump, pick one SNP and/or 1 site class at random
set.seed(1)
dat &lt;- dat[sample(nrow(dat),nrow(dat)), ] %&gt;%
  split(.$SNP_clump) %&gt;%
  map_df(~ .x[1, ])

dat &lt;- dat %&gt;% arrange(site.class)
dat$site.class &lt;- relevel(factor(dat$site.class), ref = &quot;Synonymous coding&quot;)

n_loci &lt;- prettyNum(nrow(dat), big.mark = &quot;,&quot;, scientific = FALSE)

compare_mods &lt;- function(MAF_and_Chromosome_and_site_class){
  
  MAF_and_Chromosome &lt;- update(MAF_and_Chromosome_and_site_class, ~ . -site.class)
  MAF_and_siteclass &lt;- update(MAF_and_Chromosome_and_site_class, ~ . -chr)
  Chromosome_and_siteclass &lt;- update(MAF_and_Chromosome_and_site_class, ~ . -chr)
  
  MAF &lt;- update(MAF_and_Chromosome_and_site_class, ~ . -site.class - chr)
  Chromosome &lt;- update(MAF_and_Chromosome_and_site_class, ~ . -site.class - MAF)
  siteclass &lt;- update(MAF_and_Chromosome_and_site_class, ~ .  - MAF -chr)
  Null_model &lt;- update(MAF_and_Chromosome_and_site_class, ~ . -site.class - MAF -chr)
  
  AICc(MAF_and_Chromosome_and_site_class, 
       MAF_and_Chromosome, 
       MAF_and_siteclass,
       Chromosome_and_siteclass,
       MAF, Chromosome, siteclass, 
       Null_model) %&gt;% 
    rownames_to_column(&quot;Model&quot;) %&gt;%
    arrange(AICc) %&gt;%
    mutate(delta = AICc - AICc[1],
           Model = str_replace_all(Model, &quot;_and+_&quot;, &quot; + &quot;),
           Weight = round(exp(-0.5 * delta) / sum(exp(-0.5 * delta)), 3),
           delta = round(delta, 2)) %&gt;%
    kable(digits = 2) %&gt;% kable_styling(full_width = FALSE)
}</code></pre>
<p>In each of the following analyses, the response variable is the mixture assignment probability to type <span class="math inline">\(i\)</span> for each of the 11,475 loci that affected at least one of the phenotypes significantly (defined as LFSR &lt; 0.05), where <span class="math inline">\(i\)</span> is one of the four variant types shown in the above figure. In cases where multiple SNP or indel loci were in 100% linkage with one another, we picked a single locus at random and discarded the others.</p>
<p>Three predictors were available for each locus: the minor allele frequency (MAF) in the overall DGRP, the site class of the variant, and chromosome. Loci that were annotated with more than one site class (e.g. intron as well as exon, due to an overlap of genes) were assigned one of these site classes at random.</p>
<p>To evaluate the effects of three predictors on the response variable, we fit 8 nested models and compared them using AICc. We also present the <code>summary()</code> output for the top-ranked model according to AICc.</p>
<div id="probability-of-sexual-antagonism" class="section level4 tabset">
<h4>Probability of sexual antagonism</h4>
<div id="aicc-table" class="section level5">
<h5>AICc table</h5>
<pre class="r"><code>betareg(P_sex_antag ~ MAF + chr + site.class, 
        data = dat) %&gt;% compare_mods()</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Model
</th>
<th style="text-align:right;">
df
</th>
<th style="text-align:right;">
AICc
</th>
<th style="text-align:right;">
delta
</th>
<th style="text-align:right;">
Weight
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
MAF + Chromosome
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
-42350.03
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
MAF
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
-42338.90
</td>
<td style="text-align:right;">
11.13
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
MAF + Chromosome + site_class
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
-42336.98
</td>
<td style="text-align:right;">
13.05
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
MAF + siteclass
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
-42326.30
</td>
<td style="text-align:right;">
23.73
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Chromosome + siteclass
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
-42326.30
</td>
<td style="text-align:right;">
23.73
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Chromosome
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
-42034.26
</td>
<td style="text-align:right;">
315.77
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Null_model
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-42023.09
</td>
<td style="text-align:right;">
326.94
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
siteclass
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
-42011.10
</td>
<td style="text-align:right;">
338.92
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
</div>
<div id="full-model" class="section level5">
<h5>Full model</h5>
<pre class="r"><code>p1 &lt;- summary(betareg(P_sex_antag ~ MAF + chr + site.class, data = dat), type = &quot;deviance&quot;)
p1</code></pre>
<pre><code>
Call:
betareg(formula = P_sex_antag ~ MAF + chr + site.class, data = dat)

Deviance residuals:
    Min      1Q  Median      3Q     Max 
-3.9735 -0.3399 -0.2389  0.4247  7.3555 

Coefficients (mean model with logit link):
                                  Estimate Std. Error  z value Pr(&gt;|z|)    
(Intercept)                     -2.844e+00  2.707e-02 -105.062  &lt; 2e-16 ***
MAF                              7.738e-01  4.413e-02   17.536  &lt; 2e-16 ***
chr2R                           -2.767e-02  1.706e-02   -1.622  0.10482    
chr3L                            1.040e-02  1.653e-02    0.629  0.52931    
chr3R                            4.901e-02  1.743e-02    2.812  0.00492 ** 
chrX                             2.284e-02  1.816e-02    1.258  0.20843    
site.classDownstream            -4.649e-03  2.766e-02   -0.168  0.86651    
site.classExon                  -1.381e-03  5.883e-02   -0.023  0.98127    
site.classIntergenic             1.544e-02  2.323e-02    0.664  0.50638    
site.classIntron                 5.904e-05  2.118e-02    0.003  0.99778    
site.classNon-synonymous coding -1.724e-02  4.448e-02   -0.388  0.69836    
site.classUpstream               1.938e-03  2.911e-02    0.067  0.94691    
site.classUTR 3-prime            1.483e-02  4.439e-02    0.334  0.73826    
site.classUTR 5-prime           -6.213e-02  6.034e-02   -1.030  0.30319    

Phi coefficients (precision model with identity link):
      Estimate Std. Error z value Pr(&gt;|z|)    
(phi)   34.025      0.459   74.12   &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 

Type of estimator: ML (maximum likelihood)
Log-likelihood: 2.118e+04 on 15 Df
Pseudo R-squared: 0.03202
Number of iterations: 24 (BFGS) + 2 (Fisher scoring) </code></pre>
</div>
</div>
<div id="probability-of-being-female-specific" class="section level4 tabset">
<h4>Probability of being female-specific</h4>
<div id="aicc-table-1" class="section level5">
<h5>AICc table</h5>
<pre class="r"><code>betareg(P_female_specific ~ MAF + chr + site.class, 
        data = dat) %&gt;% compare_mods()</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Model
</th>
<th style="text-align:right;">
df
</th>
<th style="text-align:right;">
AICc
</th>
<th style="text-align:right;">
delta
</th>
<th style="text-align:right;">
Weight
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Chromosome
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
-27490.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.71
</td>
</tr>
<tr>
<td style="text-align:left;">
MAF + Chromosome
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
-27488.09
</td>
<td style="text-align:right;">
1.92
</td>
<td style="text-align:right;">
0.27
</td>
</tr>
<tr>
<td style="text-align:left;">
MAF + Chromosome + site_class
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
-27482.64
</td>
<td style="text-align:right;">
7.37
</td>
<td style="text-align:right;">
0.02
</td>
</tr>
<tr>
<td style="text-align:left;">
Null_model
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-27469.40
</td>
<td style="text-align:right;">
20.61
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
MAF
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
-27467.44
</td>
<td style="text-align:right;">
22.57
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
siteclass
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
-27463.48
</td>
<td style="text-align:right;">
26.53
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
MAF + siteclass
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
-27461.51
</td>
<td style="text-align:right;">
28.50
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
Chromosome + siteclass
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
-27461.51
</td>
<td style="text-align:right;">
28.50
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
</tbody>
</table>
</div>
<div id="full-model-1" class="section level5">
<h5>Full model</h5>
<pre class="r"><code>p2 &lt;- summary(betareg(P_female_specific ~ MAF + chr + site.class, data = dat), type = &quot;deviance&quot;)
p2 </code></pre>
<pre><code>
Call:
betareg(formula = P_female_specific ~ MAF + chr + site.class, data = dat)

Deviance residuals:
    Min      1Q  Median      3Q     Max 
-1.6434 -0.7521 -0.6668 -0.2227  6.8125 

Coefficients (mean model with logit link):
                                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                     -2.116722   0.039510 -53.575  &lt; 2e-16 ***
MAF                             -0.017111   0.063606  -0.269  0.78792    
chr2R                            0.128853   0.024763   5.203 1.96e-07 ***
chr3L                            0.041026   0.024355   1.684  0.09209 .  
chr3R                            0.073953   0.025778   2.869  0.00412 ** 
chrX                             0.075132   0.026673   2.817  0.00485 ** 
site.classDownstream            -0.015492   0.040613  -0.381  0.70287    
site.classExon                  -0.034502   0.086555  -0.399  0.69018    
site.classIntergenic             0.021466   0.034162   0.628  0.52976    
site.classIntron                -0.020124   0.031169  -0.646  0.51851    
site.classNon-synonymous coding -0.004216   0.064645  -0.065  0.94800    
site.classUpstream              -0.011601   0.042774  -0.271  0.78623    
site.classUTR 3-prime            0.115638   0.064138   1.803  0.07140 .  
site.classUTR 5-prime           -0.129561   0.088245  -1.468  0.14205    

Phi coefficients (precision model with identity link):
      Estimate Std. Error z value Pr(&gt;|z|)    
(phi)   7.4541     0.1042   71.54   &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 

Type of estimator: ML (maximum likelihood)
Log-likelihood: 1.376e+04 on 15 Df
Pseudo R-squared: 0.005271
Number of iterations: 25 (BFGS) + 2 (Fisher scoring) </code></pre>
</div>
</div>
<div id="probability-of-being-male-specific" class="section level4 tabset">
<h4>Probability of being male-specific</h4>
<div id="aicc-table-2" class="section level5">
<h5>AICc table</h5>
<pre class="r"><code>betareg(P_male_specific ~ MAF + chr + site.class, 
        data = dat) %&gt;% compare_mods()</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Model
</th>
<th style="text-align:right;">
df
</th>
<th style="text-align:right;">
AICc
</th>
<th style="text-align:right;">
delta
</th>
<th style="text-align:right;">
Weight
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
MAF + Chromosome
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
-51665.18
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.86
</td>
</tr>
<tr>
<td style="text-align:left;">
Chromosome
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
-51661.58
</td>
<td style="text-align:right;">
3.60
</td>
<td style="text-align:right;">
0.14
</td>
</tr>
<tr>
<td style="text-align:left;">
MAF + Chromosome + site_class
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
-51651.42
</td>
<td style="text-align:right;">
13.76
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
MAF
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
-51640.45
</td>
<td style="text-align:right;">
24.73
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
Null_model
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-51637.32
</td>
<td style="text-align:right;">
27.86
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
MAF + siteclass
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
-51626.08
</td>
<td style="text-align:right;">
39.10
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
Chromosome + siteclass
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
-51626.08
</td>
<td style="text-align:right;">
39.10
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
siteclass
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
-51623.04
</td>
<td style="text-align:right;">
42.14
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
</tbody>
</table>
</div>
<div id="full-model-2" class="section level5">
<h5>Full model</h5>
<pre class="r"><code>p3 &lt;- summary(betareg(P_male_specific ~ MAF + chr + site.class, data = dat), type = &quot;deviance&quot;)
p3</code></pre>
<pre><code>
Call:
betareg(formula = P_male_specific ~ MAF + chr + site.class, data = dat)

Deviance residuals:
    Min      1Q  Median      3Q     Max 
-2.5524 -0.9656 -0.7707  0.3988  6.0893 

Coefficients (mean model with logit link):
                                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                     -3.201306   0.038712 -82.695  &lt; 2e-16 ***
MAF                              0.145243   0.062118   2.338   0.0194 *  
chr2R                           -0.121882   0.024354  -5.005  5.6e-07 ***
chr3L                           -0.009954   0.023508  -0.423   0.6720    
chr3R                            0.002648   0.024929   0.106   0.9154    
chrX                            -0.032578   0.025907  -1.257   0.2086    
site.classDownstream             0.004844   0.039552   0.122   0.9025    
site.classExon                   0.025183   0.083734   0.301   0.7636    
site.classIntergenic            -0.012609   0.033375  -0.378   0.7056    
site.classIntron                 0.009136   0.030390   0.301   0.7637    
site.classNon-synonymous coding -0.014042   0.063202  -0.222   0.8242    
site.classUpstream              -0.003028   0.041727  -0.073   0.9422    
site.classUTR 3-prime           -0.052903   0.063983  -0.827   0.4083    
site.classUTR 5-prime            0.024058   0.084393   0.285   0.7756    

Phi coefficients (precision model with identity link):
      Estimate Std. Error z value Pr(&gt;|z|)    
(phi)  18.5736     0.2807   66.18   &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 

Type of estimator: ML (maximum likelihood)
Log-likelihood: 2.584e+04 on 15 Df
Pseudo R-squared: 0.004862
Number of iterations: 25 (BFGS) + 2 (Fisher scoring) </code></pre>
</div>
</div>
<div id="probability-of-equal-effects" class="section level4 tabset">
<h4>Probability of equal effects</h4>
<div id="aicc-table-3" class="section level5">
<h5>AICc table</h5>
<pre class="r"><code>betareg(P_equal_effects ~ MAF + chr + site.class, 
        data = dat) %&gt;% compare_mods()</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Model
</th>
<th style="text-align:right;">
df
</th>
<th style="text-align:right;">
AICc
</th>
<th style="text-align:right;">
delta
</th>
<th style="text-align:right;">
Weight
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
MAF + Chromosome
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
-14326.50
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.76
</td>
</tr>
<tr>
<td style="text-align:left;">
MAF + Chromosome + site_class
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
-14322.90
</td>
<td style="text-align:right;">
3.59
</td>
<td style="text-align:right;">
0.13
</td>
</tr>
<tr>
<td style="text-align:left;">
MAF
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
-14322.01
</td>
<td style="text-align:right;">
4.49
</td>
<td style="text-align:right;">
0.08
</td>
</tr>
<tr>
<td style="text-align:left;">
MAF + siteclass
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
-14318.59
</td>
<td style="text-align:right;">
7.91
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:left;">
Chromosome + siteclass
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
-14318.59
</td>
<td style="text-align:right;">
7.91
</td>
<td style="text-align:right;">
0.01
</td>
</tr>
<tr>
<td style="text-align:left;">
Chromosome
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
-14248.91
</td>
<td style="text-align:right;">
77.58
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
Null_model
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-14243.28
</td>
<td style="text-align:right;">
83.22
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
siteclass
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
-14238.96
</td>
<td style="text-align:right;">
87.54
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
</tbody>
</table>
</div>
<div id="full-model-3" class="section level5">
<h5>Full model</h5>
<pre class="r"><code>p4 &lt;- summary(betareg(P_equal_effects ~ MAF + chr + site.class, data = dat), type = &quot;deviance&quot;)
p4</code></pre>
<pre><code>
Call:
betareg(formula = P_equal_effects ~ MAF + chr + site.class, data = dat)

Deviance residuals:
    Min      1Q  Median      3Q     Max 
-6.9330 -0.3277  0.2487  0.3315  2.5336 

Coefficients (mean model with logit link):
                                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                      1.457076   0.034863  41.794  &lt; 2e-16 ***
MAF                             -0.503862   0.056604  -8.902  &lt; 2e-16 ***
chr2R                           -0.041474   0.021996  -1.885  0.05937 .  
chr3L                           -0.021499   0.021512  -0.999  0.31760    
chr3R                           -0.074726   0.022726  -3.288  0.00101 ** 
chrX                            -0.048768   0.023589  -2.067  0.03870 *  
site.classDownstream             0.002297   0.035983   0.064  0.94909    
site.classExon                   0.039400   0.076890   0.512  0.60835    
site.classIntergenic            -0.040796   0.030255  -1.348  0.17753    
site.classIntron                -0.005126   0.027611  -0.186  0.85272    
site.classNon-synonymous coding  0.002345   0.057433   0.041  0.96742    
site.classUpstream              -0.012272   0.037863  -0.324  0.74586    
site.classUTR 3-prime           -0.113999   0.056976  -2.001  0.04541 *  
site.classUTR 5-prime            0.130571   0.078503   1.663  0.09626 .  

Phi coefficients (precision model with identity link):
      Estimate Std. Error z value Pr(&gt;|z|)    
(phi)  7.13163    0.09138   78.05   &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 

Type of estimator: ML (maximum likelihood)
Log-likelihood:  7176 on 15 Df
Pseudo R-squared: 0.01076
Number of iterations: 24 (BFGS) + 2 (Fisher scoring) </code></pre>
</div>
</div>
</div>
<div id="tables-of-statistical-results-models-of-twas-effects" class="section level3">
<h3>Tables of statistical results (models of TWAS effects)</h3>
<pre class="r"><code>twas &lt;- readRDS(&quot;data/derived/TWAS/TWAS_mixture_assignment_probabilities.rds&quot;) %&gt;%
  left_join(tbl(db, &quot;genes&quot;) %&gt;% select(FBID, chromosome) %&gt;% collect(), by = &quot;FBID&quot;) %&gt;%
  left_join(read_csv(&quot;data/derived/gene_expression_by_sex.csv&quot;), by = &quot;FBID&quot;) %&gt;%
  filter(chromosome %in% c(&quot;2L&quot;, &quot;2R&quot;, &quot;3L&quot;, &quot;3R&quot;, &quot;X&quot;)) %&gt;%
  mutate(h2 = (female_narrow_heritability + male_narrow_heritability) / 2)


compare_mods &lt;- function(Sex_bias_and_Chromosome_and_Expression_level_and_Heritability){
  
  Chromosome_and_Expression_level_and_Heritability &lt;- update(Sex_bias_and_Chromosome_and_Expression_level_and_Heritability, 
                                                             ~ . -male_bias_in_expression)
  Sex_bias_and_Chromosome_and_Expression_level &lt;- update(Sex_bias_and_Chromosome_and_Expression_level_and_Heritability, 
                                                             ~ . -h2)
  Sex_bias_and_Expression_level_and_Heritability &lt;- update(Sex_bias_and_Chromosome_and_Expression_level_and_Heritability, 
                                                             ~ . -chromosome)
  Sex_bias_and_Chromosome_and_Heritability &lt;- update(Sex_bias_and_Chromosome_and_Expression_level_and_Heritability, 
                                                             ~ . -AveExpr)
  
  Chromosome_and_Expression_level &lt;- update(Sex_bias_and_Chromosome_and_Expression_level_and_Heritability, ~ . -male_bias_in_expression -h2)
  Sex_bias_and_Expression_level &lt;- update(Sex_bias_and_Chromosome_and_Expression_level_and_Heritability, ~ . -chromosome -h2)
  Sex_bias_and_Chromosome &lt;- update(Sex_bias_and_Chromosome_and_Expression_level_and_Heritability, ~ . -AveExpr -h2)
  
  Heritability_and_Expression_level &lt;- update(Sex_bias_and_Chromosome_and_Expression_level_and_Heritability, 
                                              ~ . -male_bias_in_expression -chromosome)
  Heritability_and_Sex_bias &lt;- update(Sex_bias_and_Chromosome_and_Expression_level_and_Heritability, 
                                      ~ . -chromosome -AveExpr)
  Heritability_and_Chromosome &lt;- update(Sex_bias_and_Chromosome_and_Expression_level_and_Heritability, 
                                        ~ . -male_bias_in_expression -AveExpr)
  
  Chromosome &lt;- update(Chromosome_and_Expression_level, ~ . -AveExpr)
  Sex_bias &lt;- update(Sex_bias_and_Expression_level, ~ . -AveExpr)
  Expression_level &lt;- update(Sex_bias_and_Expression_level, ~ .  - male_bias_in_expression)
  Heritability &lt;- update(Heritability_and_Sex_bias, ~ .  - male_bias_in_expression)
  Null_model &lt;- update(Chromosome, ~ . -chromosome)
  
  AICc(
    Sex_bias_and_Chromosome_and_Expression_level_and_Heritability,
    Chromosome_and_Expression_level_and_Heritability,
    Sex_bias_and_Chromosome_and_Expression_level,
    Sex_bias_and_Expression_level_and_Heritability,
    Sex_bias_and_Chromosome_and_Heritability,
    Chromosome_and_Expression_level, 
    Sex_bias_and_Expression_level,
    Sex_bias_and_Chromosome,
    Heritability_and_Expression_level,
    Heritability_and_Sex_bias,
    Heritability_and_Chromosome,
    Chromosome, Sex_bias, Expression_level, Heritability,
    Null_model) %&gt;% 
    rownames_to_column(&quot;Model&quot;) %&gt;%
    arrange(AICc) %&gt;%
    mutate(delta = AICc - AICc[1],
           Model = str_replace_all(Model, &quot;_and+_&quot;, &quot; + &quot;),
           Weight = round(exp(-0.5 * delta) / sum(exp(-0.5 * delta)), 3),
           delta = round(delta, 2))
}</code></pre>
<div id="probability-of-sexual-antagonism-1" class="section level4 tabset">
<h4>Probability of sexual antagonism</h4>
<div id="aicc-table-4" class="section level5">
<h5>AICc table</h5>
<pre class="r"><code>betareg(P_sex_antag ~ male_bias_in_expression + chromosome + AveExpr + h2, 
        data = twas) %&gt;% compare_mods()</code></pre>
<pre><code>                                                     Model df      AICc delta
1                              Sex_bias + Expression_level  4 -34589.62  0.00
2                 Sex_bias + Chromosome + Expression_level  8 -34588.66  0.96
3               Sex_bias + Expression_level + Heritability  5 -34587.64  1.98
4  Sex_bias + Chromosome + Expression_level + Heritability  9 -34586.68  2.94
5                                         Expression_level  3 -34577.47 12.16
6                            Chromosome + Expression_level  7 -34576.37 13.25
7                          Heritability + Expression_level  4 -34575.65 13.97
8             Chromosome + Expression_level + Heritability  8 -34574.53 15.09
9                                  Heritability + Sex_bias  4 -34554.36 35.26
10                    Sex_bias + Chromosome + Heritability  8 -34553.42 36.21
11                                                Sex_bias  3 -34550.29 39.33
12                                   Sex_bias + Chromosome  7 -34549.20 40.42
13                                            Heritability  3 -34531.14 58.48
14                               Heritability + Chromosome  7 -34530.40 59.23
15                                              Null_model  2 -34529.07 60.55
16                                              Chromosome  6 -34528.10 61.52
   Weight
1   0.450
2   0.278
3   0.167
4   0.103
5   0.001
6   0.001
7   0.000
8   0.000
9   0.000
10  0.000
11  0.000
12  0.000
13  0.000
14  0.000
15  0.000
16  0.000</code></pre>
</div>
<div id="full-model-4" class="section level5">
<h5>Full model</h5>
<pre class="r"><code>q1 &lt;- summary(betareg(P_sex_antag ~ male_bias_in_expression + AveExpr + chromosome + h2, data = twas), type = &quot;deviance&quot;)
q1</code></pre>
<pre><code>
Call:
betareg(formula = P_sex_antag ~ male_bias_in_expression + AveExpr + chromosome + 
    h2, data = twas)

Deviance residuals:
    Min      1Q  Median      3Q     Max 
-9.1747 -0.2995  0.0292  0.2848 10.3049 

Coefficients (mean model with logit link):
                          Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)             -0.0067608  0.0333946  -0.202 0.839564    
male_bias_in_expression  0.0212796  0.0056547   3.763 0.000168 ***
AveExpr                 -0.0327572  0.0055128  -5.942 2.82e-09 ***
chromosome2R             0.0105978  0.0076951   1.377 0.168444    
chromosome3L             0.0050394  0.0077886   0.647 0.517612    
chromosome3R            -0.0077820  0.0073929  -1.053 0.292508    
chromosomeX              0.0009761  0.0083528   0.117 0.906975    
h2                      -0.0033264  0.0213525  -0.156 0.876203    

Phi coefficients (precision model with identity link):
      Estimate Std. Error z value Pr(&gt;|z|)    
(phi)  47.3331     0.5561   85.11   &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 

Type of estimator: ML (maximum likelihood)
Log-likelihood: 1.73e+04 on 9 Df
Pseudo R-squared: 0.004863
Number of iterations: 14 (BFGS) + 2 (Fisher scoring) </code></pre>
</div>
</div>
<div id="probability-of-being-female-specific-1" class="section level4 tabset">
<h4>Probability of being female-specific</h4>
<div id="aicc-table-5" class="section level5">
<h5>AICc table</h5>
<pre class="r"><code>betareg(P_female_specific ~ male_bias_in_expression + chromosome + AveExpr + h2, 
        data = twas) %&gt;% compare_mods()</code></pre>
<pre><code>                                                     Model df      AICc  delta
1  Sex_bias + Chromosome + Expression_level + Heritability  9 -47773.64   0.00
2               Sex_bias + Expression_level + Heritability  5 -47763.96   9.68
3             Chromosome + Expression_level + Heritability  8 -47758.25  15.38
4                          Heritability + Expression_level  4 -47750.58  23.06
5                     Sex_bias + Chromosome + Heritability  8 -47727.93  45.70
6                                Heritability + Chromosome  7 -47721.51  52.13
7                                  Heritability + Sex_bias  4 -47714.28  59.35
8                                             Heritability  3 -47709.71  63.92
9                 Sex_bias + Chromosome + Expression_level  8 -47677.94  95.70
10                           Chromosome + Expression_level  7 -47672.49 101.14
11                                   Sex_bias + Chromosome  7 -47667.51 106.12
12                                              Chromosome  6 -47664.52 109.11
13                             Sex_bias + Expression_level  4 -47661.38 112.25
14                                        Expression_level  3 -47657.74 115.90
15                                                Sex_bias  3 -47649.57 124.07
16                                              Null_model  2 -47648.19 125.45
   Weight
1   0.992
2   0.008
3   0.000
4   0.000
5   0.000
6   0.000
7   0.000
8   0.000
9   0.000
10  0.000
11  0.000
12  0.000
13  0.000
14  0.000
15  0.000
16  0.000</code></pre>
</div>
<div id="full-model-5" class="section level5">
<h5>Full model</h5>
<pre class="r"><code>q2 &lt;- summary(betareg(P_female_specific ~ male_bias_in_expression + AveExpr + chromosome + h2, data = twas), type = &quot;deviance&quot;)
q2</code></pre>
<pre><code>
Call:
betareg(formula = P_female_specific ~ male_bias_in_expression + AveExpr + 
    chromosome + h2, data = twas)

Deviance residuals:
    Min      1Q  Median      3Q     Max 
-5.9987 -0.2762 -0.2203  0.3220  9.7146 

Coefficients (mean model with logit link):
                        Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)             -2.74270    0.06550 -41.871  &lt; 2e-16 ***
male_bias_in_expression  0.04691    0.01105   4.246 2.17e-05 ***
AveExpr                  0.07410    0.01079   6.866 6.62e-12 ***
chromosome2R             0.01296    0.01515   0.856   0.3921    
chromosome3L             0.02633    0.01529   1.722   0.0851 .  
chromosome3R             0.01513    0.01454   1.041   0.2981    
chromosomeX              0.06422    0.01625   3.952 7.77e-05 ***
h2                      -0.40654    0.04285  -9.487  &lt; 2e-16 ***

Phi coefficients (precision model with identity link):
      Estimate Std. Error z value Pr(&gt;|z|)    
(phi)  32.5062     0.3905   83.25   &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 

Type of estimator: ML (maximum likelihood)
Log-likelihood: 2.39e+04 on 9 Df
Pseudo R-squared: 0.008403
Number of iterations: 17 (BFGS) + 2 (Fisher scoring) </code></pre>
</div>
</div>
<div id="probability-of-being-female-specific-2" class="section level4 tabset">
<h4>Probability of being female-specific</h4>
<div id="aicc-table-6" class="section level5">
<h5>AICc table</h5>
<pre class="r"><code>betareg(P_male_specific ~ male_bias_in_expression + chromosome + AveExpr + h2,
        data = twas) %&gt;% compare_mods()</code></pre>
<pre><code>                                                     Model df      AICc delta
1               Sex_bias + Expression_level + Heritability  5 -48541.57  0.00
2  Sex_bias + Chromosome + Expression_level + Heritability  9 -48536.30  5.27
3                          Heritability + Expression_level  4 -48531.28 10.29
4             Chromosome + Expression_level + Heritability  8 -48525.64 15.93
5                              Sex_bias + Expression_level  4 -48525.47 16.10
6                 Sex_bias + Chromosome + Expression_level  8 -48520.08 21.49
7                                         Expression_level  3 -48509.93 31.64
8                            Chromosome + Expression_level  7 -48504.39 37.18
9                                  Heritability + Sex_bias  4 -48501.00 40.57
10                                                Sex_bias  3 -48498.88 42.69
11                    Sex_bias + Chromosome + Heritability  8 -48495.65 45.92
12                                   Sex_bias + Chromosome  7 -48493.54 48.03
13                                            Heritability  3 -48479.33 62.25
14                                              Null_model  2 -48475.30 66.28
15                               Heritability + Chromosome  7 -48473.93 67.65
16                                              Chromosome  6 -48470.07 71.50
   Weight
1   0.928
2   0.066
3   0.005
4   0.000
5   0.000
6   0.000
7   0.000
8   0.000
9   0.000
10  0.000
11  0.000
12  0.000
13  0.000
14  0.000
15  0.000
16  0.000</code></pre>
</div>
<div id="full-model-6" class="section level5">
<h5>Full model</h5>
<pre class="r"><code>q3 &lt;- summary(betareg(P_male_specific ~ male_bias_in_expression + AveExpr + chromosome + h2, data = twas), type = &quot;deviance&quot;)
q3</code></pre>
<pre><code>
Call:
betareg(formula = P_male_specific ~ male_bias_in_expression + AveExpr + 
    chromosome + h2, data = twas)

Deviance residuals:
    Min      1Q  Median      3Q     Max 
-4.5503 -0.3445 -0.2935  0.2302  7.7542 

Coefficients (mean model with logit link):
                         Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)             -2.923866   0.073749 -39.646  &lt; 2e-16 ***
male_bias_in_expression -0.043979   0.012576  -3.497  0.00047 ***
AveExpr                  0.079554   0.012143   6.552 5.69e-11 ***
chromosome2R            -0.020737   0.017004  -1.220  0.22264    
chromosome3L            -0.012236   0.017187  -0.712  0.47653    
chromosome3R             0.002803   0.016277   0.172  0.86327    
chromosomeX             -0.009666   0.018381  -0.526  0.59900    
h2                      -0.195834   0.047498  -4.123 3.74e-05 ***

Phi coefficients (precision model with identity link):
      Estimate Std. Error z value Pr(&gt;|z|)    
(phi)  27.3715     0.3325   82.33   &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 

Type of estimator: ML (maximum likelihood)
Log-likelihood: 2.428e+04 on 9 Df
Pseudo R-squared: 0.005682
Number of iterations: 16 (BFGS) + 2 (Fisher scoring) </code></pre>
</div>
</div>
<div id="probability-of-equal-effects-1" class="section level4 tabset">
<h4>Probability of equal effects</h4>
<div id="aicc-table-7" class="section level5">
<h5>AICc table</h5>
<pre class="r"><code>betareg(P_equal_effects ~ male_bias_in_expression + chromosome + AveExpr + chromosome + h2, 
        data = twas) %&gt;% compare_mods()</code></pre>
<pre><code>                                                     Model df      AICc  delta
1  Sex_bias + Chromosome + Expression_level + Heritability  9 -27223.43   0.00
2               Sex_bias + Expression_level + Heritability  5 -27218.69   4.74
3             Chromosome + Expression_level + Heritability  8 -27215.11   8.33
4                          Heritability + Expression_level  4 -27209.96  13.48
5                 Sex_bias + Chromosome + Expression_level  8 -27208.79  14.65
6                              Sex_bias + Expression_level  4 -27202.92  20.51
7                            Chromosome + Expression_level  7 -27196.06  27.38
8                                         Expression_level  3 -27189.30  34.13
9                                    Sex_bias + Chromosome  7 -27119.08 104.36
10                    Sex_bias + Chromosome + Heritability  8 -27117.14 106.29
11                                                Sex_bias  3 -27112.39 111.04
12                                 Heritability + Sex_bias  4 -27110.55 112.89
13                                              Chromosome  6 -27093.17 130.27
14                               Heritability + Chromosome  7 -27091.62 131.81
15                                              Null_model  2 -27084.72 138.71
16                                            Heritability  3 -27083.46 139.97
   Weight
1   0.900
2   0.084
3   0.014
4   0.001
5   0.001
6   0.000
7   0.000
8   0.000
9   0.000
10  0.000
11  0.000
12  0.000
13  0.000
14  0.000
15  0.000
16  0.000</code></pre>
</div>
<div id="full-model-7" class="section level5">
<h5>Full model</h5>
<pre class="r"><code>q4 &lt;- summary(betareg(P_equal_effects ~ male_bias_in_expression + AveExpr + chromosome + h2, data = twas), type = &quot;deviance&quot;)
q4</code></pre>
<pre><code>
Call:
betareg(formula = P_equal_effects ~ male_bias_in_expression + AveExpr + 
    chromosome + h2, data = twas)

Deviance residuals:
    Min      1Q  Median      3Q     Max 
-4.8118 -0.2348 -0.1783  0.3070  7.5082 

Coefficients (mean model with logit link):
                         Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)             -2.126579   0.069649 -30.533  &lt; 2e-16 ***
male_bias_in_expression -0.038117   0.011843  -3.219  0.00129 ** 
AveExpr                  0.119363   0.011467  10.409  &lt; 2e-16 ***
chromosome2R            -0.023619   0.016095  -1.468  0.14223    
chromosome3L            -0.002435   0.016249  -0.150  0.88088    
chromosome3R             0.025941   0.015377   1.687  0.09161 .  
chromosomeX              0.019449   0.017339   1.122  0.26199    
h2                      -0.178916   0.044641  -4.008 6.13e-05 ***

Phi coefficients (precision model with identity link):
      Estimate Std. Error z value Pr(&gt;|z|)    
(phi)  15.1428     0.1773   85.43   &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 

Type of estimator: ML (maximum likelihood)
Log-likelihood: 1.362e+04 on 9 Df
Pseudo R-squared: 0.01041
Number of iterations: 16 (BFGS) + 1 (Fisher scoring) </code></pre>
</div>
</div>
<div id="probability-of-null-effect" class="section level4 tabset">
<h4>Probability of null effect</h4>
<div id="aicc-table-8" class="section level5">
<h5>AICc table</h5>
<pre class="r"><code>betareg(P_null ~ male_bias_in_expression + chromosome + AveExpr + chromosome + h2,
        data = twas) %&gt;% compare_mods()</code></pre>
<pre><code>                                                     Model df      AICc  delta
1                     Sex_bias + Chromosome + Heritability  8 -35661.32   0.00
2  Sex_bias + Chromosome + Expression_level + Heritability  9 -35660.68   0.64
3                                  Heritability + Sex_bias  4 -35648.78  12.53
4               Sex_bias + Expression_level + Heritability  5 -35648.64  12.68
5                                Heritability + Chromosome  7 -35558.74 102.58
6             Chromosome + Expression_level + Heritability  8 -35557.57 103.74
7                                             Heritability  3 -35552.40 108.92
8                          Heritability + Expression_level  4 -35550.92 110.40
9                 Sex_bias + Chromosome + Expression_level  8 -35492.75 168.57
10                                   Sex_bias + Chromosome  7 -35481.17 180.15
11                             Sex_bias + Expression_level  4 -35476.03 185.29
12                                                Sex_bias  3 -35465.76 195.55
13                           Chromosome + Expression_level  7 -35425.13 236.18
14                                        Expression_level  3 -35414.44 246.88
15                                              Chromosome  6 -35401.55 259.77
16                                              Null_model  2 -35392.88 268.44
   Weight
1   0.578
2   0.420
3   0.001
4   0.001
5   0.000
6   0.000
7   0.000
8   0.000
9   0.000
10  0.000
11  0.000
12  0.000
13  0.000
14  0.000
15  0.000
16  0.000</code></pre>
</div>
<div id="full-model-8" class="section level5">
<h5>Full model</h5>
<pre class="r"><code>q5 &lt;- summary(betareg(P_null ~ male_bias_in_expression + AveExpr + chromosome + h2, data = twas), type = &quot;deviance&quot;)
q5</code></pre>
<pre><code>
Call:
betareg(formula = P_null ~ male_bias_in_expression + AveExpr + chromosome + 
    h2, data = twas)

Deviance residuals:
    Min      1Q  Median      3Q     Max 
-5.7613 -0.2551  0.2343  0.6056  4.0831 

Coefficients (mean model with logit link):
                        Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)             -1.88870    0.06935 -27.235  &lt; 2e-16 ***
male_bias_in_expression  0.12119    0.01162  10.429  &lt; 2e-16 ***
AveExpr                  0.01336    0.01145   1.166 0.243430    
chromosome2R             0.05820    0.01598   3.642 0.000271 ***
chromosome3L             0.02774    0.01623   1.708 0.087544 .  
chromosome3R             0.02367    0.01542   1.535 0.124697    
chromosomeX              0.06355    0.01730   3.674 0.000239 ***
h2                      -0.58221    0.04586 -12.694  &lt; 2e-16 ***

Phi coefficients (precision model with identity link):
      Estimate Std. Error z value Pr(&gt;|z|)    
(phi)  19.9272     0.2367   84.18   &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 

Type of estimator: ML (maximum likelihood)
Log-likelihood: 1.784e+04 on 9 Df
Pseudo R-squared: 0.01282
Number of iterations: 19 (BFGS) + 2 (Fisher scoring) </code></pre>
</div>
</div>
</div>
<div id="plots-showing-the-statistical-results" class="section level3">
<h3>Plots showing the statistical results</h3>
<pre class="r"><code>gwas_stats_fig &lt;- bind_rows(p1$coefficients$mean %&gt;%
            as.data.frame() %&gt;%
            rownames_to_column(&quot;Parameter&quot;) %&gt;%
            mutate(type = &quot;P(sexually antagonistic)&quot;),
          p2$coefficients$mean %&gt;%
            as.data.frame() %&gt;%
            rownames_to_column(&quot;Parameter&quot;) %&gt;%
            mutate(type = &quot;P(female-specific)&quot;),
          p3$coefficients$mean %&gt;%
            as.data.frame() %&gt;%
            rownames_to_column(&quot;Parameter&quot;) %&gt;%
            mutate(type = &quot;P(male-specific)&quot;),
          p4$coefficients$mean %&gt;%
            as.data.frame() %&gt;%
            rownames_to_column(&quot;Parameter&quot;) %&gt;%
            mutate(type = &quot;P(equal effects)&quot;)) %&gt;%
  mutate(Parameter = str_replace_all(Parameter, &quot;site[.]class&quot;, &quot;Site class: &quot;),
         Parameter = str_replace_all(Parameter, &quot;chr&quot;, &quot;Chromosome: &quot;),
         sig = ifelse(`Pr(&gt;|z|)` &lt; 0.05, &quot;yes&quot;, &quot;no&quot;)) %&gt;%
  filter(Parameter != &quot;(Intercept)&quot;) %&gt;%
  arrange(Parameter) %&gt;%
  mutate(Parameter = factor(Parameter, rev(unique(Parameter)))) %&gt;%
  ggplot(aes(Parameter, Estimate, colour = sig)) +
  geom_hline(yintercept = 0, linetype = 2) +
  geom_errorbar(aes(ymin = Estimate - `Std. Error`*1.96, ymax = Estimate + `Std. Error`*1.96), width = 0) + 
  geom_point() + 
  coord_flip() +
  facet_wrap(~type) +
  theme_bw() +
  theme(legend.position = &quot;none&quot;,
        strip.background = element_blank(), 
        text = element_text(family = &quot;Raleway&quot;, size = 12)) +
  scale_color_manual(values = c(&quot;black&quot;, &quot;tomato&quot;)) + 
  ylab(&quot;Estimate \u00B1 95% CIs&quot;) 

twas_stats_fig &lt;- bind_rows(q1$coefficients$mean %&gt;%
            as.data.frame() %&gt;%
            rownames_to_column(&quot;Parameter&quot;) %&gt;%
            mutate(type = &quot;P(sexually antagonistic)&quot;),
          q2$coefficients$mean %&gt;%
            as.data.frame() %&gt;%
            rownames_to_column(&quot;Parameter&quot;) %&gt;%
            mutate(type = &quot;P(female-specific)&quot;),
          q3$coefficients$mean %&gt;%
            as.data.frame() %&gt;%
            rownames_to_column(&quot;Parameter&quot;) %&gt;%
            mutate(type = &quot;P(male-specific)&quot;),
          q4$coefficients$mean %&gt;%
            as.data.frame() %&gt;%
            rownames_to_column(&quot;Parameter&quot;) %&gt;%
            mutate(type = &quot;P(equal effects)&quot;),
          q5$coefficients$mean %&gt;%
            as.data.frame() %&gt;%
            rownames_to_column(&quot;Parameter&quot;) %&gt;%
            mutate(type = &quot;P(null effect)&quot;)) %&gt;%
  mutate(Parameter = str_replace_all(Parameter, &quot;AveExpr&quot;, &quot;Average expression level&quot;),
         Parameter = str_replace_all(Parameter, &quot;male_bias_in_expression&quot;, &quot;Male bias in expression&quot;),
         Parameter = str_replace_all(Parameter, &quot;chromosome&quot;, &quot;Chromosome: &quot;),
         sig = ifelse(`Pr(&gt;|z|)` &lt; 0.05, &quot;yes&quot;, &quot;no&quot;),
         type = factor(type, c(&quot;P(null effect)&quot;, &quot;P(equal effects)&quot;, &quot;P(sexually antagonistic)&quot;,
                               &quot;P(female-specific)&quot;, &quot;P(male-specific)&quot;))) %&gt;%
  filter(Parameter != &quot;(Intercept)&quot;) %&gt;%
  arrange(Parameter) %&gt;%
  mutate(Parameter = factor(Parameter, rev(unique(Parameter)))) %&gt;%
  ggplot(aes(Parameter, Estimate, colour = sig)) +
  geom_hline(yintercept = 0, linetype = 2) +
  geom_errorbar(aes(ymin = Estimate - `Std. Error`*1.96, ymax = Estimate + `Std. Error`*1.96), width = 0) + 
  geom_point() + 
  coord_flip() +
  facet_wrap(~type) +
  theme_bw() +
  theme(legend.position = &quot;none&quot;,
        strip.background = element_blank(), 
        text = element_text(family = &quot;Raleway&quot;, size = 12)) +
  scale_color_manual(values = c(&quot;black&quot;, &quot;tomato&quot;)) + 
  ylab(&quot;Estimate \u00B1 95% CIs&quot;) 


ggsave(&quot;figures/GWAS_stats_figure.pdf&quot;, gwas_stats_fig, width = 6, height = 6)
ggsave(&quot;figures/TWAS_stats_figure.pdf&quot;, twas_stats_fig, width = 7, height = 6)</code></pre>
<div id="effect-sizes-for-the-gwas-analysis" class="section level4">
<h4>Effect sizes for the GWAS analysis</h4>
<pre class="r"><code>gwas_stats_fig</code></pre>
<p><img src="figure/plot_models_variant_effects.Rmd/unnamed-chunk-33-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-33-1">
Past versions of unnamed-chunk-33-1.png
</button>
</p>
<div id="fig-unnamed-chunk-33-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/8d14298b4d59c2198b6f9c62d415e6adc9b7e658/docs/figure/plot_models_variant_effects.Rmd/unnamed-chunk-33-1.png" target="_blank">8d14298</a>
</td>
<td>
lukeholman
</td>
<td>
2021-09-26
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Figure XX</strong>: The figure shows estimated parameters from four separate beta regression models seeking predictors of the mixture assignment probabilities calculated using <code>mashr</code> on the GWAS results. Positive values indicate that the predictor is associated with an elevated probability across loci; estimates that are non-zero with 95% confidence are shown in red. The clearest result is the strong, positive relationship between minor allele frequency (MAF) and the probability that the locus was assigned to the ‘sexually antagonistic’ mixture component. There was also a strong, negative relationship between MAF and the chance that the locus was assigned to the ‘equal effects’ mixture component (i.e. that the locus had concordant effects on male and female fitness). Loci with a relatively high probability of being female-specific tended to have <em>lower</em> MAF, while loci with a relatively high probability of being male-specific tended to have <em>higher</em> MAF. Chromosome 2L seems to be enriched for loci with male-specific effects, and de-enriched for loci that affect females relative to the other chromosomes. Finally, there were some associations between site class and mixture assignment probability, which (though sometimes statistically significant) were small and subtle.</p>
</div>
<div id="effect-sizes-for-the-twas-analysis" class="section level4">
<h4>Effect sizes for the TWAS analysis</h4>
<pre class="r"><code>twas_stats_fig</code></pre>
<p><img src="figure/plot_models_variant_effects.Rmd/unnamed-chunk-34-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-34-1">
Past versions of unnamed-chunk-34-1.png
</button>
</p>
<div id="fig-unnamed-chunk-34-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/8d14298b4d59c2198b6f9c62d415e6adc9b7e658/docs/figure/plot_models_variant_effects.Rmd/unnamed-chunk-34-1.png" target="_blank">8d14298</a>
</td>
<td>
lukeholman
</td>
<td>
2021-09-26
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Figure XX</strong>: The figure shows estimated parameters from five separate beta regression models seeking predictors of the mixture assignment probabilities calculated using <code>mashr</code> on the TWAS results. Positive values indicate that the predictor is associated with an elevated probability across transcripts; estimates that are non-zero with 95% confidence are shown in red. The clearest result is the strong, negative relationship between the heritability of the transcript’s expression level (calculated by Huang et al. 2015) and the probability that the transcript was assigned to any mixture component other than ‘sexually antagonistic’. Transcripts with strongly male-biased expression were more likely to have no relationship with fitness (i.e. to be assigned to the ‘null’ mixture component); sex bias was a significant but weak predictor for the other mixture components. Transcripts with high expression levels were more likely to have a sexually concordant relationship with fitness, and less likely to be sexually antagonistic. Transcripts from genes located on the X chromosome were slightly more likely to have a female-specific correlation with fitness, or no correlation.</p>
</div>
</div>
</div>
<div id="effect-of-the-minor-allele" class="section level2">
<h2>Effect of the minor allele</h2>
<p>Evolutionary theory makes various testable predictions about the effects of the major and minor alleles on phenotypes, especially phenotypes that are closely correlated with fitness. For example, the minor allele should generally be associated with the lower-fitness phenotype (and the major allele with the higher-fitness phenotype), due to selection removing the lower-fitness allele. Furthermore, it is interesting to ask whether the female-beneficial allele or the male-beneficial allele tends to be the major allele at sexually-antagonistic loci? Lastly, we might expect different results at loci where the minor allele is quite rare vs loci where the minor allele is only slightly rarer than the major allele; loci with comparatively low MAF are more likely to reflect new polymorphisms (since most mutations are neutral or deleterious, and it takes time for the minor allele to drift towards high frequencies), and are more likely to be under selection (since selection against the minor allele keeps it rare).</p>
<p>To address these questions graphically, we here plot the effects on male and female early-life fitness of each allele, that was assigned to the female-specific, male-specific, or sexually antagonistic mixture component by <code>mashr</code>, with an assignment probability in the highest 0.1% across all the loci analysed. Since there were 1,665,770 loci, each column plots the male and female effect sizes for 1,665 loci.</p>
<p>Among the top 0.1% of loci with female-specific effects on fitness (first column), the minor allele was usually associated with reduced female fitness among loci where the minor allele frequency was below 0.2, as expected if alleles that harm female fitness are removed by selection. Among loci with MAF &gt; 0.2, the minor allele beneficial to female fitness almost as often as the major allele was.</p>
<p>There was no similar finding for the top 0.1% of loci with loci with <em>male</em>-specific effects (second column): the minor allele was equally likely to increase or reduce fitness, regardless of MAF. Also, most of these top male-specific loci had quite high minor allele frequencies, perhaps suggesting their effects on fitness were weaker than for the loci with female-specific fitness effects.</p>
<p>For the top 0.1% of loci with sexually-antagonistic effects on fitness (third column), the minor allele frequencies again tended to be high (above 0.2), suggesting either weak overall purifying selection (due to counteracting effects of selection on males and females), or even balancing selection. The minor allele tended to be the one that reduced female fitness and elevated male fitness, though alleles with the reverse effect were present as well.</p>
<p>Finally, among loci inferred to be under sexually concordant selection, the effect sizes were strongest among loci with MAF &lt; 0.2, as expected if selection prevents alleles with strong, detrimental effects on the fitness of both sexes from becoming common.</p>
<pre class="r"><code>histo_data &lt;- tbl(db, &quot;univariate_lmm_results&quot;) %&gt;% 
  left_join(tbl(db, &quot;variants&quot;) %&gt;% 
               select(SNP, MAF, site.class), 
             by = &quot;SNP&quot;) %&gt;%
  filter(!is.na(LFSR_female_early_mashr_ED)) %&gt;% 
  collect(n = Inf) %&gt;% 
  mutate(class = 
           case_when(
             P_sex_antag &gt; quantile(P_sex_antag, probs = 0.999)  ~ &quot;Top 0.1%\nsexually antagonistic loci&quot;,
             P_equal_effects &gt; quantile(P_equal_effects, probs = 0.999)  ~ &quot;Top 0.1%\nsexually concordant loci&quot;,
             P_female_specific &gt; quantile(P_female_specific, probs = 0.999)  ~ &quot;Top 0.1%\nfemale-specific loci&quot;,
             P_male_specific &gt; quantile(P_male_specific, probs = 0.999)  ~ &quot;Top 0.1%\nmale-specific loci&quot;,
           )) %&gt;%
  mutate(MAF = ifelse(MAF &lt; 0.2, &quot;0.05 &lt; MAF &lt; 0.2&quot;, &quot;0.2 &lt; MAF &lt; 0.5&quot;)) %&gt;%
  filter(!is.na(class)) %&gt;%
  select(beta_female_early_mashr_ED, beta_male_early_mashr_ED, class, MAF)

eff_size_histos &lt;- ggplot(histo_data, aes(beta_female_early_mashr_ED)) + 
  geom_vline(xintercept = 0, linetype = 2) +
  geom_histogram(bins=30, fill=&quot;tomato&quot;, colour=NA, alpha = 0.5) + 
  geom_histogram(aes(beta_male_early_mashr_ED), bins=30, fill=&quot;steelblue&quot;, colour=NA, alpha = 0.5) + 
  geom_histogram(bins=30, fill=NA, colour=&quot;black&quot;) + 
  geom_histogram(aes(beta_male_early_mashr_ED), bins=30,fill=NA,colour=&quot;black&quot;) + 
  facet_grid(MAF ~ class, scales = &quot;free_y&quot;) +
  xlab(&quot;Effect of the minor allele on early-life fitness\n(females:red, males:blue)&quot;) + 
  theme_bw() +
  theme(legend.position = &quot;none&quot;,
        strip.background = element_blank(), 
        text = element_text(family = &quot;Raleway&quot;, size = 12)) +
  ylab(&quot;Number of loci&quot;)

ggsave(&quot;figures/eff_size_histos.pdf&quot;, width = 8, height = 5)
eff_size_histos</code></pre>
<p><img src="figure/plot_models_variant_effects.Rmd/unnamed-chunk-36-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-36-1">
Past versions of unnamed-chunk-36-1.png
</button>
</p>
<div id="fig-unnamed-chunk-36-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/8d14298b4d59c2198b6f9c62d415e6adc9b7e658/docs/figure/plot_models_variant_effects.Rmd/unnamed-chunk-36-1.png" target="_blank">8d14298</a>
</td>
<td>
lukeholman
</td>
<td>
2021-09-26
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="manhattan-plot" class="section level2">
<h2>Manhattan plot</h2>
<p><strong>Figure legend</strong>: Manhattan plot showing the p-values (-log_{10} transformed) for each variant, from mixed model GWAS of female (top) and male (bottom) early-life fitness testing the null hypothesis that the two alleles are associated with equal fitness values.</p>
<pre class="r"><code>manhattan_data &lt;- tbl(db, &quot;univariate_lmm_results&quot;) %&gt;% 
  select(SNP, starts_with(&quot;P_&quot;),
         pvalue_female_early_raw, pvalue_male_early_raw) %&gt;%
  distinct() %&gt;%
  collect(n=Inf) %&gt;%
  mutate(position = str_split(SNP, &quot;_&quot;),
         chr = map_chr(position, ~ .x[1]),
         position = as.numeric(map_chr(position, ~ .x[2]))) %&gt;% 
         # P_pleiotropy = 1 - P_null - P_female_specific - P_male_specific,
         # SA_not_concord = P_sex_antag &gt; P_equal_effects,
         # top_SA = P_sex_antag &gt;= quantile(P_sex_antag, probs=0.9999)) %&gt;% 
  filter(chr != &quot;4&quot;) 

max_pos &lt;- manhattan_data %&gt;%
  group_by(chr) %&gt;%
  summarise(max_pos = max(position), .groups = &quot;drop&quot;) %&gt;%
  as.data.frame()
max_pos$max_pos &lt;- c(0, cumsum(max_pos$max_pos[1:4]))

manhattan_data &lt;- manhattan_data %&gt;%
    left_join(max_pos, by = &quot;chr&quot;) %&gt;%
    mutate(position = position + max_pos) 


p1 &lt;- manhattan_data %&gt;%
  ggplot(aes(position, -1 * log10(pvalue_female_early_raw), group = chr, colour = chr, stroke = 0.2)) + 
  geom_point(size = 0.5) +
  # geom_point(data = manhattan_data %&gt;% filter(top_SA), 
  #            aes(y = 8), size = 3, pch = 6) +
  scale_colour_brewer(palette = &quot;Paired&quot;, name = &quot;Chromosome&quot;) + 
  scale_y_continuous(limits = c(0,8)) +
  ylab(expression(paste(&quot;Effect on female early-life fitness (-&quot;, Log[10], &quot; p)&quot;))) + 
  xlab(&quot;&quot;) +
  theme_bw() + 
  theme(axis.text.x = element_blank(),
        panel.border = element_blank(),
        axis.ticks.x = element_blank())

p2 &lt;- manhattan_data %&gt;%
  ggplot(aes(position, -1 * log10(pvalue_male_early_raw), group = chr, colour = chr, stroke = 0.2)) + 
  geom_point(size = 0.5) +
  scale_colour_brewer(palette = &quot;Paired&quot;, name = &quot;Chromosome&quot;) + 
  ylab(expression(paste(&quot;Effect on male early-life fitness (-&quot;, Log[10], &quot; p)&quot;))) + 
  xlab(&quot;Position&quot;) +
  scale_y_reverse(limits = c(8,0)) +
  theme_bw() + 
  theme(axis.text.x = element_blank(),
        panel.border = element_blank(),
        axis.ticks.x = element_blank())

grid_arrange_shared_legend &lt;- function(..., ncol = length(list(...)), nrow = 1) {

  plots &lt;- list(...)
  # position &lt;- match.arg(position)
  g &lt;- ggplotGrob(plots[[1]] + theme(legend.position = &quot;right&quot;))$grobs
  legend &lt;- g[[which(sapply(g, function(x) x$name) == &quot;guide-box&quot;)]]
  lheight &lt;- sum(legend$height)
  lwidth &lt;- sum(legend$width)
  gl &lt;- lapply(plots, function(x) x + theme(legend.position=&quot;none&quot;))
  gl &lt;- c(gl, ncol = ncol, nrow = nrow)
  
  combined &lt;- arrangeGrob(arrangeGrob(gl[[1]], gl[[2]], nrow = 2),
                          legend,
                          ncol = 2,
                          widths = unit.c(unit(1, &quot;npc&quot;) - lwidth, lwidth))
  
  grid.newpage()
  grid.draw(combined)

  # return gtable invisibly
  invisible(combined)

}

grid_arrange_shared_legend(p1, p2)</code></pre>
<p><img src="figure/plot_models_variant_effects.Rmd/unnamed-chunk-37-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-37-1">
Past versions of unnamed-chunk-37-1.png
</button>
</p>
<div id="fig-unnamed-chunk-37-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/4953d582430e0be9ac5f56212ce2e1ee0478d936/docs/figure/plot_models_variant_effects.Rmd/unnamed-chunk-37-1.png" target="_blank">4953d58</a>
</td>
<td>
lukeholman
</td>
<td>
2021-09-26
</td>
</tr>
<tr>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/8d14298b4d59c2198b6f9c62d415e6adc9b7e658/docs/figure/plot_models_variant_effects.Rmd/unnamed-chunk-37-1.png" target="_blank">8d14298</a>
</td>
<td>
lukeholman
</td>
<td>
2021-09-26
</td>
</tr>
</tbody>
</table>
</div>
</div>
<!-- ```{r} -->
<!-- manhattan_data <- tbl(db, "univariate_lmm_results") %>%  -->
<!--   select(SNP, starts_with("P_"), -->
<!--          beta_female_early_mashr_ED, beta_male_early_mashr_ED) %>% -->
<!--   distinct() %>% -->
<!--   collect(n=Inf) %>% -->
<!--   mutate(position = str_split(SNP, "_"), -->
<!--          chr = map_chr(position, ~ .x[1]), -->
<!--          position = as.numeric(map_chr(position, ~ .x[2])), -->
<!--          P_pleiotropy = 1 - P_null - P_female_specific - P_male_specific, -->
<!--          SA_not_concord = P_sex_antag > P_equal_effects, -->
<!--          top_SA = P_sex_antag >= quantile(P_sex_antag, probs=0.9999)) %>% -->
<!--   mutate(beta_female_early_mashr_ED = abs(beta_female_early_mashr_ED), -->
<!--          beta_male_early_mashr_ED = abs(beta_male_early_mashr_ED)) %>% -->
<!--   # mutate(beta_male_early_mashr_ED = replace( -->
<!--   #   beta_male_early_mashr_ED,  -->
<!--   #   beta_female_early_mashr_ED < 0,  -->
<!--   #   beta_male_early_mashr_ED[beta_female_early_mashr_ED < 0] * -1), -->
<!--   #   beta_female_early_mashr_ED = replace( -->
<!--   #   beta_female_early_mashr_ED,  -->
<!--   #   beta_female_early_mashr_ED < 0,  -->
<!--   #   beta_female_early_mashr_ED[beta_female_early_mashr_ED < 0] * -1), -->
<!--   #   ) %>% -->
<!--   filter(chr != "4")  -->
<!-- max_pos <- manhattan_data %>% -->
<!--   group_by(chr) %>% -->
<!--   summarise(max_pos = max(position), .groups = "drop") %>% -->
<!--   as.data.frame() -->
<!-- max_pos$max_pos <- c(0, cumsum(max_pos$max_pos[1:4])) -->
<!-- manhattan_data <- manhattan_data %>% -->
<!--     left_join(max_pos, by = "chr") %>% -->
<!--     mutate(position = position + max_pos)  -->
<!-- # cols <- c("blue", "skyblue", "red", "pink", "orange", "yellow", -->
<!-- #           "purple", "steelblue", "green", "tomato") -->
<!-- # manhattan_data %>% -->
<!-- #   filter(P_pleiotropy > 0.7485376) %>% -->
<!-- #   sample_n(100000) %>% -->
<!-- #   ggplot(aes(position, -1 * log10(1 - P_pleiotropy), colour = chr, stroke = 0.2)) + -->
<!-- #   geom_point(size = 0.5, pch = 1) + -->
<!-- #  # scale_color_manual(values = cols) + -->
<!-- #   # scale_fill_brewer(palette = "Paired", name = "Chromosome") +  -->
<!-- #   scale_colour_brewer(palette = "Paired", name = "Chromosome") +  -->
<!-- #   ylab("-log10(Posterior probability of null effect)") + -->
<!-- #   theme_bw() + -->
<!-- #   theme(axis.text.x = element_blank(), -->
<!-- #         axis.ticks.x = element_blank()) -->
<!-- p1 <- manhattan_data %>% -->
<!--   ggplot(aes(position, beta_female_early_mashr_ED, group = chr, colour = chr, stroke = 0.2)) +  -->
<!--   geom_point(size = 0.5) + -->
<!--   geom_point(data = manhattan_data %>% filter(top_SA), -->
<!--              aes(y = 0.43), size = 3, pch = 6) + -->
<!--   scale_colour_brewer(palette = "Paired", name = "Chromosome") +  -->
<!--   ylab("Effect on female fitness") +  -->
<!--   xlab("") + -->
<!--   theme_bw() +  -->
<!--   theme(axis.text.x = element_blank(), -->
<!--         panel.border = element_blank(), -->
<!--         axis.ticks.x = element_blank()) -->
<!-- p2 <- manhattan_data %>% -->
<!--   ggplot(aes(position, beta_male_early_mashr_ED, group = chr, colour = chr, stroke = 0.2)) +  -->
<!--   geom_point(size = 0.5) + -->
<!--   scale_colour_brewer(palette = "Paired", name = "Chromosome") +  -->
<!--   ylab("Effect on male fitness") +  -->
<!--   xlab("Position") + -->
<!--   scale_y_reverse() + -->
<!--   theme_bw() +  -->
<!--   theme(axis.text.x = element_blank(), -->
<!--         panel.border = element_blank(), -->
<!--         axis.ticks.x = element_blank()) -->
<!-- grid.arrange(p1, p2) -->
<!-- ``` -->
</div>
<div id="antagonism-ratios-figure" class="section level2">
<h2>Antagonism ratios figure</h2>
<pre class="r"><code>make_evidence_ratio_plot &lt;- function(dat, ymax, ylab){
  # Argument needs to be dataframe of loci or transcripts, which are identified by col called &quot;identifier&quot;
  # The FE, FL,ME, ML effect sizes need to be called pheno1-pheno4
  # The corresponding LFSR columns need to be called LFSR1-LFSR4
  
  antagonism_evidence_ratios &lt;- dat %&gt;%
    
    # Convert the LFSR to probability that beta is positive
    # Here, we use the ED results because they are agnostic to our expectations for the results
    # However, running this with the Canonocial results instead gives an essentially identical graph
    mutate(pp_female_early = ifelse(pheno1 &gt; 0, LFSR1, 1 - LFSR1),
           pp_female_late  = ifelse(pheno2 &gt; 0, LFSR2, 1 - LFSR2),
           pp_male_early   = ifelse(pheno3 &gt; 0, LFSR3, 1 - LFSR3),
           pp_male_late    = ifelse(pheno4 &gt; 0, LFSR4, 1 - LFSR4)) %&gt;%
    
    # Calculate the probabilities that beta_i and beta_j have the same/opposite signs
    mutate(p_sex_concord_early = pp_female_early * pp_male_early + 
             (1 - pp_female_early) * (1 - pp_male_early),
           p_sex_antag_early = pp_female_early * (1 - pp_male_early) + 
             (1 - pp_female_early) * pp_male_early,
           p_sex_concord_late  = pp_female_late * pp_male_late + 
             (1 - pp_female_late) * (1 - pp_male_late),
           p_sex_antag_late = pp_female_late * (1 - pp_male_late) + 
             (1 - pp_female_late) * pp_male_late,
           p_age_concord_females = pp_female_early * pp_female_late + 
             (1 - pp_female_early) * (1 - pp_female_late),
           p_age_antag_females = pp_female_early * (1 - pp_female_late) + 
             (1 - pp_female_early) * pp_female_late,
           p_age_concord_males = pp_male_early * pp_male_late + (1 - pp_male_early) * (1 - pp_male_late),
           p_age_antag_males = pp_male_early * (1 - pp_male_late) + (1 - pp_male_early) * pp_male_late) %&gt;%
    
    # Find the ratios of some of these probabilities (i.e. &quot;evidence ratios&quot;)
    mutate(`Inter-sex (early life)` = p_sex_concord_early / p_sex_antag_early,
           `Inter-sex (late life)` = p_sex_concord_late / p_sex_antag_late,
           `Inter-age (females)` = p_age_concord_females / p_age_antag_females,
           `Inter-age (males)` = p_age_concord_males / p_age_antag_males) %&gt;%
    select(identifier,  starts_with(&quot;Inter&quot;)) %&gt;%
    gather(trait, evidence_ratio, -identifier) %&gt;%
    mutate(trait = factor(trait, c(&quot;Inter-sex (early life)&quot;,
                                   &quot;Inter-sex (late life)&quot;,
                                   &quot;Inter-age (females)&quot;,
                                   &quot;Inter-age (males)&quot;)))
  print(antagonism_evidence_ratios %&gt;% arrange(evidence_ratio))
  antagonism_evidence_ratios %&gt;%
    ggplot(aes(log2(evidence_ratio))) + 
    geom_histogram(data=subset(antagonism_evidence_ratios, evidence_ratio &lt; 1), 
                   bins = 500, fill = &quot;#FF635C&quot;) + 
    geom_histogram(data=subset(antagonism_evidence_ratios, evidence_ratio &gt; 1), 
                   bins = 500, fill = &quot;#5B8AFD&quot;) +
    coord_cartesian(xlim = c(-10, 10), ylim = c(0, ymax)) + 
    scale_x_continuous(breaks = c(-10,  -6,  -2,   2,   6,  10), 
                       labels = c(paste(&quot;1/&quot;,2 ^ c(10,  6,  2), sep = &quot;&quot;), 2 ^ c(2,6,10))) + 
    facet_wrap(~ trait) + 
    xlab(&quot;Evidence ratio (log2 scale)&quot;) + ylab(ylab) + 
    theme_bw() + 
    theme(panel.border = element_rect(size = 0.8),
         # text = element_text(family = &quot;Raleway&quot;, size = 12),
          axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
          strip.background = element_blank())
}

GWAS_ratios_plot &lt;- SNP_clumps %&gt;%
  rename(pheno1 = beta_female_early_mashr_ED, 
         pheno2 = beta_female_late_mashr_ED, 
         pheno3 = beta_male_early_mashr_ED, 
         pheno4 = beta_male_late_mashr_ED,
         LFSR1 = LFSR_female_early_mashr_ED, 
         LFSR2 = LFSR_female_late_mashr_ED, 
         LFSR3 = LFSR_male_early_mashr_ED, 
         LFSR4 = LFSR_male_late_mashr_ED,
         identifier = SNP_clump) %&gt;%
  make_evidence_ratio_plot(ymax = 10000, ylab = &quot;Number of loci&quot;)</code></pre>
<pre><code># A tibble: 4,829,428 x 3
   identifier                     trait                  evidence_ratio
   &lt;chr&gt;                          &lt;fct&gt;                           &lt;dbl&gt;
 1 3L_18098299_SNP                Inter-sex (early life)          0.127
 2 2L_4378111_SNP, 2L_4378127_SNP Inter-sex (early life)          0.275
 3 2R_12475593_SNP                Inter-sex (early life)          0.306
 4 2R_12475593_SNP                Inter-sex (late life)           0.323
 5 X_15519378_SNP                 Inter-sex (early life)          0.327
 6 X_6233582_SNP                  Inter-sex (early life)          0.335
 7 3L_18098299_SNP                Inter-sex (late life)           0.347
 8 3R_23687589_SNP                Inter-sex (early life)          0.360
 9 2L_4378050_SNP                 Inter-sex (early life)          0.364
10 2L_4674413_SNP                 Inter-sex (early life)          0.367
# … with 4,829,418 more rows</code></pre>
<pre class="r"><code>TWAS_ED &lt;- readRDS(&quot;data/derived/TWAS/TWAS_ED.rds&quot;)
TWAS_canonical &lt;- readRDS(&quot;data/derived/TWAS/TWAS_canonical.rds&quot;)


TWAS_mashr_results &lt;- 
  data.frame(
    FBID = read_csv(&quot;data/derived/TWAS/TWAS_results.csv&quot;)$FBID,
    as.data.frame(get_pm(TWAS_canonical)) %&gt;% rename_all(~str_c(&quot;canonical_&quot;, .)),
    as.data.frame(get_lfsr(TWAS_canonical)) %&gt;% 
      rename_all(~str_replace_all(., &quot;beta&quot;, &quot;LFSR&quot;)) %&gt;% rename_all(~str_c(&quot;canonical_&quot;, .))) %&gt;% 
  as_tibble() %&gt;% 
  bind_cols(
    data.frame(
      as.data.frame(get_pm(TWAS_ED)) %&gt;% rename_all(~str_c(&quot;ED_&quot;, .)),
      as.data.frame(get_lfsr(TWAS_ED)) %&gt;% 
        rename_all(~str_replace_all(., &quot;beta&quot;, &quot;LFSR&quot;)) %&gt;% rename_all(~str_c(&quot;ED_&quot;, .))) %&gt;% 
      as_tibble())

TWAS_ratios_plot &lt;- TWAS_mashr_results %&gt;%
  rename(pheno1 = ED_beta_FE, 
         pheno2 = ED_beta_FL, 
         pheno3 = ED_beta_ME, 
         pheno4 = ED_beta_ML,
         LFSR1 = ED_LFSR_FE, 
         LFSR2 = ED_LFSR_FL, 
         LFSR3 = ED_LFSR_ME, 
         LFSR4 = ED_LFSR_ML,
         identifier = FBID) %&gt;%
  make_evidence_ratio_plot(ymax = 500, ylab = &quot;Number of transcripts&quot;)</code></pre>
<pre><code># A tibble: 57,144 x 3
   identifier  trait                  evidence_ratio
   &lt;chr&gt;       &lt;fct&gt;                           &lt;dbl&gt;
 1 FBgn0013275 Inter-sex (early life)        0.00849
 2 FBgn0013275 Inter-sex (late life)         0.00950
 3 FBgn0263092 Inter-sex (early life)        0.00991
 4 FBgn0263092 Inter-sex (late life)         0.0109 
 5 FBgn0261615 Inter-sex (early life)        0.0118 
 6 FBgn0261615 Inter-sex (late life)         0.0144 
 7 FBgn0000022 Inter-sex (late life)         0.0154 
 8 FBgn0000022 Inter-sex (early life)        0.0168 
 9 FBgn0027330 Inter-sex (late life)         0.0191 
10 FBgn0027330 Inter-sex (early life)        0.0193 
# … with 57,134 more rows</code></pre>
<pre class="r"><code>pp &lt;- plot_grid(GWAS_ratios_plot, TWAS_ratios_plot, 
                   labels = c(&#39;A&#39;, &#39;B&#39;), label_size = 12)
# ggdraw(add_sub(pp, &quot;Evidence ratio (log scale)&quot;, 
#                vpadding=grid::unit(0,&quot;lines&quot;), 
#                y=6.3, x=0.5, vjust=6))
ggsave(&quot;figures/antagonism_ratios.pdf&quot;, pp, width = 8.5, height = 4.9)

pp</code></pre>
<p><img src="figure/plot_models_variant_effects.Rmd/evidence_ratio_plot-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-evidence_ratio_plot-1">
Past versions of evidence_ratio_plot-1.png
</button>
</p>
<div id="fig-evidence_ratio_plot-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/8d14298b4d59c2198b6f9c62d415e6adc9b7e658/docs/figure/plot_models_variant_effects.Rmd/evidence_ratio_plot-1.png" target="_blank">8d14298</a>
</td>
<td>
lukeholman
</td>
<td>
2021-09-26
</td>
</tr>
<tr>
<td>
<a href="https://github.com/lukeholman/fitnessGWAS/blob/e112260eb7edb940edc701a4180d2cf98f9d1145/docs/figure/plot_models_variant_effects.Rmd/evidence_ratio_plot-1.png" target="_blank">e112260</a>
</td>
<td>
lukeholman
</td>
<td>
2021-03-04
</td>
</tr>
</tbody>
</table>
</div>
</div>
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>R version 4.0.3 (2020-10-10)
Platform: x86_64-apple-darwin17.0 (64-bit)
Running under: macOS Catalina 10.15.7

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib

locale:
[1] en_GB.UTF-8/en_GB.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8

attached base packages:
[1] grid      stats     graphics  grDevices utils     datasets  methods  
[8] base     

other attached packages:
 [1] lmtest_0.9-37    zoo_1.8-8        MuMIn_1.43.17    betareg_3.1-4   
 [5] cowplot_1.0.0    kableExtra_1.3.4 mashr_0.2.38     ashr_2.2-47     
 [9] showtext_0.9-2   showtextdb_3.0   sysfonts_0.8.3   Hmisc_4.4-0     
[13] Formula_1.2-3    survival_3.2-7   lattice_0.20-41  ggbeeswarm_0.6.0
[17] qqman_0.1.4      gridExtra_2.3    forcats_0.5.0    stringr_1.4.0   
[21] dplyr_1.0.0      purrr_0.3.4      readr_2.0.0      tidyr_1.1.0     
[25] tibble_3.0.1     ggplot2_3.3.2    tidyverse_1.3.0  workflowr_1.6.2 

loaded via a namespace (and not attached):
  [1] colorspace_1.4-1    modeltools_0.2-23   ellipsis_0.3.1     
  [4] rprojroot_1.3-2     htmlTable_1.13.3    base64enc_0.1-3    
  [7] fs_1.4.1            rstudioapi_0.11     hexbin_1.28.1      
 [10] farver_2.0.3        flexmix_2.3-15      bit64_0.9-7        
 [13] fansi_0.4.1         mvtnorm_1.1-0       lubridate_1.7.10   
 [16] xml2_1.3.2          splines_4.0.3       knitr_1.32         
 [19] jsonlite_1.7.0      broom_0.5.6         cluster_2.1.0      
 [22] dbplyr_1.4.4        png_0.1-7           compiler_4.0.3     
 [25] httr_1.4.1          backports_1.1.7     assertthat_0.2.1   
 [28] Matrix_1.2-18       cli_2.0.2           later_1.0.0        
 [31] acepack_1.4.1       htmltools_0.5.0     tools_4.0.3        
 [34] gtable_0.3.0        glue_1.4.2          Rcpp_1.0.4.6       
 [37] cellranger_1.1.0    vctrs_0.3.0         svglite_1.2.3      
 [40] nlme_3.1-149        xfun_0.22           rvest_0.3.5        
 [43] lifecycle_0.2.0     irlba_2.3.3         MASS_7.3-53        
 [46] scales_1.1.1        vroom_1.5.3         hms_0.5.3          
 [49] promises_1.1.0      parallel_4.0.3      sandwich_2.5-1     
 [52] RColorBrewer_1.1-2  curl_4.3            yaml_2.2.1         
 [55] memoise_1.1.0       gdtools_0.2.2       rpart_4.1-15       
 [58] RSQLite_2.2.0       latticeExtra_0.6-29 calibrate_1.7.7    
 [61] stringi_1.5.3       SQUAREM_2020.2      rmeta_3.0          
 [64] highr_0.8           checkmate_2.0.0     truncnorm_1.0-8    
 [67] rlang_0.4.6         pkgconfig_2.0.3     systemfonts_0.2.2  
 [70] evaluate_0.14       invgamma_1.1        labeling_0.3       
 [73] htmlwidgets_1.5.1   bit_1.1-15.2        tidyselect_1.1.0   
 [76] plyr_1.8.6          magrittr_2.0.1      R6_2.4.1           
 [79] generics_0.0.2      DBI_1.1.0           mgcv_1.8-33        
 [82] pillar_1.4.4        haven_2.3.1         whisker_0.4        
 [85] foreign_0.8-80      withr_2.2.0         abind_1.4-5        
 [88] mixsqp_0.3-43       nnet_7.3-14         modelr_0.1.8       
 [91] crayon_1.3.4        utf8_1.1.4          tzdb_0.1.2         
 [94] rmarkdown_2.5       jpeg_0.1-8.1        isoband_0.2.1      
 [97] readxl_1.3.1        data.table_1.12.8   blob_1.2.1         
[100] git2r_0.27.1        webshot_0.5.2       reprex_0.3.0       
[103] digest_0.6.25       httpuv_1.5.3.1      stats4_4.0.3       
[106] munsell_0.5.0       viridisLite_0.3.0   beeswarm_0.4.0     
[109] vipor_0.4.5        </code></pre>
</div>
</div>


<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
http://docs.mathjax.org/en/latest/configuration.html.  This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
